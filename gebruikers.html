<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Medewerkers ¬∑ MijnSanadome</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600&family=Plus+Jakarta+Sans:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --sanadome-blue: #3b82c4;
      --sanadome-blue-light: #60a5e8;
      --sanadome-blue-pale: #eff6ff;
      --sanadome-blue-mist: #f0f7ff;
      --sanadome-text: #0f172a;
      --sanadome-text-soft: #64748b;
      --sanadome-border: #e2e8f0;
      --white: #ffffff;
      --radius: 16px;
      --radius-sm: 10px;
      --sidebar-w: 270px;
      --topbar-h: 68px;
      --shadow-card: 0 1px 2px rgba(0,0,0,0.04), 0 4px 16px rgba(0,0,0,0.04);
      --shadow-card-hover: 0 8px 30px rgba(59,130,196,0.10), 0 2px 8px rgba(0,0,0,0.04);
      --shadow-elevated: 0 12px 40px rgba(0,0,0,0.08), 0 4px 12px rgba(0,0,0,0.04);
      --gradient-primary: linear-gradient(135deg, #3b82c4 0%, #60a5e8 100%);
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'DM Sans', -apple-system, sans-serif;
      min-height: 100vh;
      background: #f1f5f9;
      color: var(--sanadome-text);
      font-size: 15px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
    }
    .app-layout { display: flex; min-height: 100vh; }

    /* ‚Äî‚Äî Sidebar ‚Äî‚Äî */
    .app-sidebar {
      width: var(--sidebar-w); min-width: var(--sidebar-w);
      background: var(--white); border-right: 1px solid var(--sanadome-border);
      display: flex; flex-direction: column;
      position: fixed; top: 0; left: 0; bottom: 0; z-index: 100;
    }
    .sidebar-logo {
      display: flex; align-items: center; gap: 0.7rem;
      padding: 1.25rem 1.5rem; text-decoration: none; color: var(--sanadome-text);
      border-bottom: 1px solid var(--sanadome-border);
    }
    .sidebar-logo svg { width: 36px; height: 36px; flex-shrink: 0; }
    .sidebar-logo-text {
      font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 700;
      font-size: 1.2rem; letter-spacing: -0.02em; color: var(--sanadome-text);
    }
    .sidebar-logo-text span { color: var(--sanadome-blue); }
    .sidebar-nav { flex: 1; padding: 1rem 0.75rem; overflow-y: auto; }
    .nav-label {
      font-size: 0.65rem; font-weight: 600; text-transform: uppercase;
      letter-spacing: 0.1em; color: var(--sanadome-text-soft);
      padding: 0 0.75rem; margin-bottom: 0.5rem; margin-top: 0.75rem;
    }
    .nav-item {
      display: flex; align-items: center; gap: 0.75rem;
      padding: 0.6rem 0.75rem; border-radius: var(--radius-sm);
      color: var(--sanadome-text-soft); text-decoration: none;
      font-weight: 500; font-size: 0.9rem; margin-bottom: 2px;
      transition: all 0.15s ease; position: relative;
    }
    .nav-item:hover { background: var(--sanadome-blue-mist); color: var(--sanadome-text); }
    .nav-item.active { background: var(--sanadome-blue-pale); color: var(--sanadome-blue); }
    .nav-item.active::before {
      content: ''; position: absolute; left: -0.75rem; top: 50%;
      transform: translateY(-50%); width: 3px; height: 24px;
      border-radius: 0 3px 3px 0; background: var(--sanadome-blue);
    }
    .nav-item svg { width: 20px; height: 20px; flex-shrink: 0; opacity: 0.7; }
    .nav-item.active svg { opacity: 1; }

    /* ‚Äî‚Äî Main area ‚Äî‚Äî */
    .app-main { flex: 1; margin-left: var(--sidebar-w); display: flex; flex-direction: column; min-height: 100vh; }

    /* Top bar */
    .topbar {
      height: var(--topbar-h);
      background: rgba(255,255,255,0.85); backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(226,232,240,0.6);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem; gap: 1rem; position: sticky; top: 0; z-index: 50;
    }
    .topbar-search {
      flex: 1; max-width: 380px; padding: 0.55rem 1rem 0.55rem 2.75rem;
      font-family: inherit; font-size: 0.875rem; color: var(--sanadome-text);
      background: #f1f5f9; border: 1.5px solid transparent;
      border-radius: var(--radius-sm); outline: none; transition: all 0.2s ease;
    }
    .topbar-search::placeholder { color: var(--sanadome-text-soft); }
    .topbar-search:focus { background: var(--white); border-color: var(--sanadome-blue); box-shadow: 0 0 0 3px rgba(59,130,196,0.1); }
    .topbar-search-wrap { position: relative; flex: 1; max-width: 380px; }
    .topbar-search-wrap::before {
      content: ''; position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%);
      width: 18px; height: 18px; border: 2px solid var(--sanadome-text-soft); border-radius: 50%; opacity: 0.5;
    }
    .topbar-search-wrap::after {
      content: ''; position: absolute; left: 1.45rem; top: 58%;
      width: 6px; height: 2px; background: var(--sanadome-text-soft);
      transform: rotate(45deg); opacity: 0.5;
    }
    .topbar-actions { display: flex; align-items: center; gap: 0.5rem; }
    .topbar-icon-btn {
      width: 40px; height: 40px; border: none; background: transparent;
      border-radius: var(--radius-sm); color: var(--sanadome-text-soft);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: all 0.15s ease; position: relative;
    }
    .topbar-icon-btn:hover { background: var(--sanadome-blue-mist); color: var(--sanadome-blue); }
    .topbar-icon-btn svg { width: 20px; height: 20px; }
    .topbar-user { display: flex; align-items: center; gap: 0.75rem; padding: 0.35rem 0.5rem 0.35rem 0.75rem; border-radius: var(--radius-sm); margin-left: 0.5rem; border: 1px solid transparent; transition: background 0.15s; }
    .topbar-user:hover { background: var(--sanadome-blue-mist); }
    .topbar-avatar {
      width: 38px; height: 38px; border-radius: 50%; overflow: hidden;
      background: var(--gradient-primary); color: var(--white);
      font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 600; font-size: 0.85rem;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(59,130,196,0.25);
    }
    .topbar-user-info { text-align: left; }
    .topbar-user-name { font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 600; font-size: 0.9rem; color: var(--sanadome-text); display: block; line-height: 1.3; }
    .topbar-user-role { font-size: 0.75rem; color: var(--sanadome-text-soft); display: block; }
    .btn-logout {
      padding: 0.45rem 0.85rem; font-size: 0.8rem; font-family: inherit; font-weight: 600;
      color: var(--white); background: var(--gradient-primary); border: none;
      border-radius: var(--radius-sm); cursor: pointer; margin-left: 0.5rem;
      transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(59,130,196,0.2);
    }
    .btn-logout:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59,130,196,0.3); }

    /* ‚Äî‚Äî Page content ‚Äî‚Äî */
    .dashboard-content { flex: 1; padding: 2rem; }

    /* Page header */
    .page-header {
      display: flex; align-items: flex-start; justify-content: space-between;
      gap: 1rem; margin-bottom: 1.75rem; flex-wrap: wrap;
    }
    .page-header-left h1 {
      font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 700;
      font-size: 1.5rem; color: var(--sanadome-text); letter-spacing: -0.02em; line-height: 1.3;
    }
    .page-header-left p { font-size: 0.875rem; color: var(--sanadome-text-soft); margin-top: 0.15rem; }
    .btn-add {
      display: inline-flex; align-items: center; gap: 0.5rem;
      padding: 0.6rem 1.25rem; font-size: 0.875rem; font-weight: 600; font-family: inherit;
      color: var(--white); background: var(--gradient-primary); border: none;
      border-radius: var(--radius-sm); cursor: pointer;
      box-shadow: 0 2px 10px rgba(59,130,196,0.25);
      transition: all 0.2s ease;
    }
    .btn-add:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 4px 16px rgba(59,130,196,0.3); }
    .btn-add svg { width: 18px; height: 18px; }

    /* Stats row */
    .stats-row {
      display: flex; gap: 0.75rem; margin-bottom: 1.25rem; flex-wrap: wrap;
    }
    .stat-pill {
      display: flex; align-items: center; gap: 0.4rem;
      padding: 0.4rem 0.85rem; font-size: 0.78rem; font-weight: 600;
      background: var(--white); border: 1.5px solid var(--sanadome-border);
      border-radius: 999px; color: var(--sanadome-text-soft); cursor: default;
      transition: all 0.15s ease;
    }
    .stat-pill .stat-pill-count {
      background: var(--sanadome-blue-pale); color: var(--sanadome-blue);
      padding: 0.1rem 0.45rem; border-radius: 999px; font-size: 0.72rem; font-weight: 700;
      min-width: 20px; text-align: center;
    }

    /* Filter bar */
    .filter-bar {
      display: flex; align-items: center; gap: 0.75rem;
      margin-bottom: 1.5rem; flex-wrap: wrap;
    }
    .filter-search-wrap {
      position: relative; flex: 1; min-width: 200px; max-width: 340px;
    }
    .filter-search {
      width: 100%; padding: 0.55rem 1rem 0.55rem 2.5rem;
      font-family: inherit; font-size: 0.85rem; color: var(--sanadome-text);
      background: var(--white); border: 1.5px solid var(--sanadome-border);
      border-radius: var(--radius-sm); outline: none; transition: all 0.2s ease;
    }
    .filter-search:focus { border-color: var(--sanadome-blue); box-shadow: 0 0 0 3px rgba(59,130,196,0.1); }
    .filter-search::placeholder { color: var(--sanadome-text-soft); }
    .filter-search-wrap svg {
      position: absolute; left: 0.7rem; top: 50%; transform: translateY(-50%);
      width: 16px; height: 16px; color: var(--sanadome-text-soft); pointer-events: none;
    }
    .filter-pills { display: flex; gap: 0.35rem; flex-wrap: wrap; }
    .filter-pill {
      padding: 0.4rem 0.85rem; font-size: 0.78rem; font-weight: 600; font-family: inherit;
      background: var(--white); border: 1.5px solid var(--sanadome-border);
      border-radius: 999px; color: var(--sanadome-text-soft); cursor: pointer;
      transition: all 0.15s ease; white-space: nowrap;
    }
    .filter-pill:hover { border-color: var(--sanadome-blue); color: var(--sanadome-blue); }
    .filter-pill.active {
      background: var(--sanadome-blue); color: var(--white);
      border-color: var(--sanadome-blue);
    }

    /* Users grid */
    .users-grid {
      display: grid; grid-template-columns: repeat(3, 1fr);
      gap: 1.25rem;
    }

    /* User card */
    .user-card {
      background: var(--white); border-radius: var(--radius);
      border: 1px solid rgba(226,232,240,0.7); box-shadow: var(--shadow-card);
      overflow: hidden; transition: all 0.25s ease;
      display: flex; flex-direction: column; align-items: center;
      padding: 1.75rem 1.25rem 1.25rem; text-align: center;
    }
    .user-card:hover {
      box-shadow: var(--shadow-card-hover);
      border-color: rgba(59,130,196,0.12);
      transform: translateY(-3px);
    }
    .user-card-avatar {
      width: 64px; height: 64px; border-radius: 50%;
      background: var(--gradient-primary); color: var(--white);
      font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 700; font-size: 1.25rem;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 1rem; flex-shrink: 0;
      box-shadow: 0 4px 14px rgba(59,130,196,0.25);
    }
    /* Role-based avatar gradients */
    .user-card[data-role="senior-medewerker"] .user-card-avatar { background: linear-gradient(135deg, #059669, #34d399); box-shadow: 0 4px 14px rgba(5,150,105,0.25); }
    .user-card[data-role="assistent-manager"] .user-card-avatar { background: linear-gradient(135deg, #d97706, #fbbf24); box-shadow: 0 4px 14px rgba(217,119,6,0.25); }
    .user-card[data-role="manager"] .user-card-avatar { background: linear-gradient(135deg, #7c3aed, #a78bfa); box-shadow: 0 4px 14px rgba(124,58,237,0.25); }

    .user-card-name {
      font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 700;
      font-size: 0.95rem; color: var(--sanadome-text); margin-bottom: 0.15rem;
    }
    .user-card-email {
      font-size: 0.8rem; color: var(--sanadome-text-soft); margin-bottom: 0.15rem;
      word-break: break-all;
    }
    .user-card-phone {
      font-size: 0.78rem; color: var(--sanadome-text-soft); margin-bottom: 0.5rem;
    }

    /* Role badges */
    .role-badge {
      display: inline-block; padding: 0.2rem 0.65rem; font-size: 0.68rem;
      font-weight: 700; border-radius: 999px; letter-spacing: 0.01em;
      margin-bottom: 0.85rem;
    }
    .role-badge.role-medewerker { background: #dbeafe; color: #1e40af; }
    .role-badge.role-senior-medewerker { background: #d1fae5; color: #065f46; }
    .role-badge.role-assistent-manager { background: #fef3c7; color: #92400e; }
    .role-badge.role-manager { background: #ede9fe; color: #5b21b6; }

    .user-card-meta {
      font-size: 0.7rem; color: var(--sanadome-text-soft); opacity: 0.7;
      margin-bottom: 0.85rem;
    }

    .user-card-actions {
      display: flex; gap: 0.5rem; width: 100%;
      border-top: 1px solid var(--sanadome-border); padding-top: 0.85rem; margin-top: auto;
    }
    .card-action-btn {
      flex: 1; display: flex; align-items: center; justify-content: center; gap: 0.3rem;
      padding: 0.45rem; font-size: 0.78rem; font-weight: 600; font-family: inherit;
      border: 1.5px solid var(--sanadome-border); border-radius: var(--radius-sm);
      background: var(--white); color: var(--sanadome-text-soft); cursor: pointer;
      transition: all 0.15s ease;
    }
    .card-action-btn:hover { border-color: var(--sanadome-blue); color: var(--sanadome-blue); background: var(--sanadome-blue-mist); }
    .card-action-btn.delete-btn:hover { border-color: #ef4444; color: #ef4444; background: #fef2f2; }
    .card-action-btn svg { width: 14px; height: 14px; }

    /* Empty state */
    .empty-state {
      grid-column: 1 / -1;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 3rem 1.5rem; text-align: center;
    }
    .empty-state-icon {
      width: 72px; height: 72px; border-radius: 50%;
      background: var(--sanadome-blue-pale); color: var(--sanadome-blue);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.75rem; margin-bottom: 1rem;
    }
    .empty-state h3 {
      font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 700;
      font-size: 1rem; color: var(--sanadome-text); margin-bottom: 0.25rem;
    }
    .empty-state p { font-size: 0.85rem; color: var(--sanadome-text-soft); }

    /* Loading skeleton */
    .skeleton-card {
      background: var(--white); border-radius: var(--radius);
      border: 1px solid rgba(226,232,240,0.7); padding: 1.75rem 1.25rem;
      display: flex; flex-direction: column; align-items: center;
    }
    .skeleton-circle {
      width: 64px; height: 64px; border-radius: 50%;
      background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
      background-size: 200%; animation: shimmer 1.5s infinite; margin-bottom: 1rem;
    }
    .skeleton-line {
      height: 12px; border-radius: 6px;
      background: linear-gradient(90deg, #e2e8f0 25%, #f1f5f9 50%, #e2e8f0 75%);
      background-size: 200%; animation: shimmer 1.5s infinite; margin-bottom: 0.5rem;
    }
    .skeleton-line.w60 { width: 60%; }
    .skeleton-line.w80 { width: 80%; }
    .skeleton-line.w40 { width: 40%; }
    @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    /* ‚Äî‚Äî Modals ‚Äî‚Äî */
    .modal-backdrop {
      position: fixed; inset: 0;
      background: rgba(15,23,42,0.45); backdrop-filter: blur(6px);
      z-index: 1000; display: flex; align-items: center; justify-content: center;
      opacity: 0; visibility: hidden; transition: all 0.25s ease;
    }
    .modal-backdrop.active { opacity: 1; visibility: visible; }
    .modal {
      background: var(--white); border-radius: var(--radius);
      box-shadow: var(--shadow-elevated); width: 100%; max-width: 480px;
      max-height: 90vh; overflow-y: auto;
      transform: translateY(16px) scale(0.97);
      transition: transform 0.25s ease;
    }
    .modal-backdrop.active .modal { transform: translateY(0) scale(1); }
    .modal-sm { max-width: 400px; }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--sanadome-border);
    }
    .modal-header h2 {
      font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 700;
      font-size: 1.05rem; color: var(--sanadome-text);
    }
    .modal-close {
      width: 32px; height: 32px; border: none; background: transparent;
      font-size: 1.25rem; color: var(--sanadome-text-soft); cursor: pointer;
      border-radius: var(--radius-sm); display: flex; align-items: center;
      justify-content: center; transition: all 0.15s ease;
    }
    .modal-close:hover { background: #f1f5f9; color: var(--sanadome-text); }
    .modal-body { padding: 1.5rem; }
    .modal-footer {
      display: flex; align-items: center; justify-content: flex-end; gap: 0.5rem;
      padding: 1rem 1.5rem; border-top: 1px solid var(--sanadome-border);
    }

    /* Form */
    .form-group { margin-bottom: 1rem; }
    .form-group:last-child { margin-bottom: 0; }
    .form-label {
      display: block; font-size: 0.8rem; font-weight: 600;
      color: var(--sanadome-text); margin-bottom: 0.35rem;
    }
    .form-label .optional { font-weight: 400; color: var(--sanadome-text-soft); }
    .form-input, .form-select {
      width: 100%; padding: 0.6rem 0.85rem;
      font-family: inherit; font-size: 0.875rem; color: var(--sanadome-text);
      background: var(--white); border: 1.5px solid var(--sanadome-border);
      border-radius: var(--radius-sm); outline: none; transition: all 0.2s ease;
    }
    .form-input:focus, .form-select:focus { border-color: var(--sanadome-blue); box-shadow: 0 0 0 3px rgba(59,130,196,0.1); }
    .form-input::placeholder { color: var(--sanadome-text-soft); }
    .form-select { appearance: none; cursor: pointer; background-image: url("data:image/svg+xml,%3Csvg width='10' height='6' viewBox='0 0 10 6' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1L5 5L9 1' stroke='%2364748b' stroke-width='1.5' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 0.85rem center; padding-right: 2.5rem; }

    .password-wrap {
      display: flex; gap: 0.35rem;
    }
    .password-wrap .form-input { flex: 1; font-family: 'DM Sans', monospace; }
    .pw-btn {
      width: 38px; height: 38px; flex-shrink: 0;
      border: 1.5px solid var(--sanadome-border); background: var(--white);
      border-radius: var(--radius-sm); color: var(--sanadome-text-soft);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      font-size: 1rem; transition: all 0.15s ease;
    }
    .pw-btn:hover { border-color: var(--sanadome-blue); color: var(--sanadome-blue); }
    .pw-hint { font-size: 0.72rem; color: var(--sanadome-text-soft); margin-top: 0.3rem; }

    .btn-cancel {
      padding: 0.5rem 1rem; font-size: 0.85rem; font-weight: 600; font-family: inherit;
      background: var(--white); border: 1.5px solid var(--sanadome-border);
      border-radius: var(--radius-sm); color: var(--sanadome-text); cursor: pointer;
      transition: all 0.15s ease;
    }
    .btn-cancel:hover { border-color: var(--sanadome-blue); color: var(--sanadome-blue); }
    .btn-submit {
      padding: 0.5rem 1.25rem; font-size: 0.85rem; font-weight: 600; font-family: inherit;
      background: var(--gradient-primary); border: none;
      border-radius: var(--radius-sm); color: var(--white); cursor: pointer;
      box-shadow: 0 2px 8px rgba(59,130,196,0.2);
      transition: all 0.2s ease;
    }
    .btn-submit:hover { opacity: 0.9; transform: translateY(-1px); }
    .btn-submit:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-danger {
      padding: 0.5rem 1.25rem; font-size: 0.85rem; font-weight: 600; font-family: inherit;
      background: linear-gradient(135deg, #ef4444, #f87171); border: none;
      border-radius: var(--radius-sm); color: var(--white); cursor: pointer;
      box-shadow: 0 2px 8px rgba(239,68,68,0.2);
      transition: all 0.2s ease;
    }
    .btn-danger:hover { opacity: 0.9; transform: translateY(-1px); }

    /* Password display (success modal) */
    .password-display {
      display: flex; align-items: center; gap: 0.5rem;
      padding: 0.65rem 0.85rem; background: #f1f5f9; border-radius: var(--radius-sm);
      border: 1.5px solid var(--sanadome-border); margin: 0.85rem 0;
    }
    .password-display code {
      flex: 1; font-family: 'DM Sans', monospace; font-size: 0.95rem;
      font-weight: 600; color: var(--sanadome-text); letter-spacing: 0.03em;
      user-select: all; word-break: break-all;
    }
    .btn-copy {
      padding: 0.3rem 0.7rem; font-size: 0.75rem; font-weight: 600; font-family: inherit;
      background: var(--white); border: 1.5px solid var(--sanadome-border);
      border-radius: 6px; color: var(--sanadome-text-soft); cursor: pointer;
      transition: all 0.15s ease; white-space: nowrap;
    }
    .btn-copy:hover { border-color: var(--sanadome-blue); color: var(--sanadome-blue); }
    .pw-warning {
      font-size: 0.75rem; color: #dc2626; font-weight: 500;
      margin-bottom: 1rem; line-height: 1.4;
    }

    /* Toast */
    .toast {
      position: fixed; top: calc(var(--topbar-h) + 1rem); right: 2rem;
      padding: 0.75rem 1.25rem; border-radius: var(--radius-sm);
      font-size: 0.85rem; font-weight: 500; z-index: 9999;
      opacity: 0; transform: translateY(-10px); pointer-events: none;
      transition: all 0.35s ease; max-width: 380px;
      box-shadow: var(--shadow-elevated);
    }
    .toast.show { opacity: 1; transform: translateY(0); pointer-events: auto; }
    .toast.success { background: #d1fae5; color: #065f46; border: 1px solid #a7f3d0; }
    .toast.error { background: #fee2e2; color: #991b1b; border: 1px solid #fca5a5; }

    /* No admin key banner */
    .admin-warning {
      display: flex; align-items: center; gap: 0.75rem;
      padding: 1rem 1.25rem; background: #fef3c7; border: 1.5px solid #fde68a;
      border-radius: var(--radius); color: #92400e; font-size: 0.875rem;
      margin-bottom: 1.5rem;
    }
    .admin-warning svg { width: 22px; height: 22px; flex-shrink: 0; }

    /* Responsive */
    @media (max-width: 1200px) { .users-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 900px) {
      .app-sidebar { transform: translateX(-100%); }
      .app-main { margin-left: 0; }
      .topbar-search-wrap { max-width: 180px; }
    }
    @media (max-width: 700px) {
      .users-grid { grid-template-columns: 1fr; }
      .page-header { flex-direction: column; }
      .filter-bar { flex-direction: column; align-items: stretch; }
      .filter-search-wrap { max-width: none; }
      .dashboard-content { padding: 1.25rem; }
    }
  </style>
</head>
<body>
  <div class="app-layout">
    <aside class="app-sidebar">
      <a href="dashboard.html" class="sidebar-logo" aria-label="MijnSanadome">
        <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="40" height="40" rx="10" fill="url(#lg)"/>
          <path d="M12 28V16l8 7 8-7v12h-3V19l-5 4.5-5-4.5v9H12z" fill="white"/>
          <defs><linearGradient id="lg" x1="0" y1="0" x2="40" y2="40" gradientUnits="userSpaceOnUse"><stop stop-color="#4a7c9c"/><stop offset="1" stop-color="#6b9bb8"/></linearGradient></defs>
        </svg>
        <span class="sidebar-logo-text">Mijn<span>Sanadome</span></span>
      </a>
      <nav class="sidebar-nav">
        <div class="nav-label">Menu</div>
        <a href="dashboard.html" class="nav-item">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          Dashboard
        </a>
        <a href="#placeholder-rooster" class="nav-item" data-permission="nav.rooster">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
          Mijn rooster
        </a>
        <a href="#placeholder-verlof" class="nav-item" data-permission="nav.verlof">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
          Verlof
        </a>
        <a href="#placeholder-documenten" class="nav-item" data-permission="nav.documenten">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
          Documenten
        </a>
        <a href="#placeholder-berichten" class="nav-item" data-permission="nav.berichten">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
          Berichten
        </a>
        <div class="nav-label">Beheer</div>
        <a href="gebruikers.html" class="nav-item active" data-permission="medewerkers.bekijken">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
          Medewerkers
        </a>
        <a href="nieuws.html" class="nav-item" data-permission="nieuws.bekijken">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><line x1="10" y1="6" x2="18" y2="6"/><line x1="10" y1="10" x2="18" y2="10"/><line x1="10" y1="14" x2="14" y2="14"/></svg>
          Nieuwsbeheer
        </a>
        <a href="debiteuren.html" class="nav-item" data-permission="debiteuren.bekijken">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
          Debiteuren
        </a>
        <a href="rechten.html" class="nav-item" data-permission="rechten.bekijken">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
          Rechten
        </a>
        <div class="nav-label">Account</div>
        <a href="profiel.html" class="nav-item" data-permission="nav.gegevens">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
          Mijn Profiel
        </a>
        <a href="#placeholder-hr" class="nav-item" data-permission="nav.hr">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          HR &amp; handboek
        </a>
      </nav>
    </aside>

    <div class="app-main">
      <header class="topbar">
        <div class="topbar-search-wrap">
          <input type="search" class="topbar-search" placeholder="Zoeken in MijnSanadome‚Ä¶" aria-label="Zoeken">
        </div>
        <div class="topbar-actions">
          <button type="button" class="topbar-icon-btn" aria-label="Meldingen">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
          </button>
          <a href="profiel.html" class="topbar-user" style="text-decoration:none;color:inherit;">
            <div class="topbar-avatar" id="user-avatar">‚Äî</div>
            <div class="topbar-user-info">
              <span class="topbar-user-name" id="user-name">Laden‚Ä¶</span>
              <span class="topbar-user-role">Medewerker</span>
            </div>
          </a>
          <button type="button" class="btn-logout" id="btn-logout">Uitloggen</button>
        </div>
      </header>

      <main class="dashboard-content">
        <!-- Admin key warning (hidden by default) -->
        <div class="admin-warning" id="admin-warning" style="display:none;">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
          <span>Service role key ontbreekt in de configuratie. Gebruikersbeheer is niet beschikbaar.</span>
        </div>

        <!-- Page header -->
        <div class="page-header">
          <div class="page-header-left">
            <h1>Medewerkers</h1>
            <p>Beheer je team, rollen en toegang</p>
          </div>
          <button type="button" class="btn-add" id="btn-add-user">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Nieuwe medewerker
          </button>
        </div>

        <!-- Stats -->
        <div class="stats-row" id="stats-row"></div>

        <!-- Filter bar -->
        <div class="filter-bar">
          <div class="filter-search-wrap">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <input type="search" class="filter-search" id="filter-search" placeholder="Zoek medewerker‚Ä¶">
          </div>
          <div class="filter-pills" id="filter-pills"></div>
        </div>

        <!-- Users grid -->
        <div class="users-grid" id="users-grid">
          <!-- Skeleton loading -->
          <div class="skeleton-card"><div class="skeleton-circle"></div><div class="skeleton-line w60"></div><div class="skeleton-line w80"></div><div class="skeleton-line w40"></div></div>
          <div class="skeleton-card"><div class="skeleton-circle"></div><div class="skeleton-line w60"></div><div class="skeleton-line w80"></div><div class="skeleton-line w40"></div></div>
          <div class="skeleton-card"><div class="skeleton-circle"></div><div class="skeleton-line w60"></div><div class="skeleton-line w80"></div><div class="skeleton-line w40"></div></div>
        </div>
      </main>
    </div>
  </div>

  <!-- Create / Edit Modal -->
  <div class="modal-backdrop" id="modal-user">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modal-title">Nieuwe medewerker</h2>
        <button type="button" class="modal-close" id="modal-close">&times;</button>
      </div>
      <form id="user-form" autocomplete="off">
        <div class="modal-body">
          <div class="form-group">
            <label class="form-label">Volledige naam</label>
            <input type="text" class="form-input" id="input-name" placeholder="Bijv. Jan de Vries" required>
          </div>
          <div class="form-group">
            <label class="form-label">E-mailadres</label>
            <input type="email" class="form-input" id="input-email" placeholder="jan@sanadome.nl" required>
          </div>
          <div class="form-group" id="password-group">
            <label class="form-label">Wachtwoord</label>
            <div class="password-wrap">
              <input type="password" class="form-input" id="input-password" placeholder="Automatisch gegenereerd" required>
              <button type="button" class="pw-btn" id="pw-toggle" title="Tonen/verbergen">üëÅ</button>
              <button type="button" class="pw-btn" id="pw-regen" title="Opnieuw genereren">üîÑ</button>
            </div>
            <div class="pw-hint" id="pw-hint">Min. 8 tekens ¬∑ Wordt getoond na aanmaken</div>
          </div>
          <div class="form-group">
            <label class="form-label">Rol</label>
            <select class="form-select" id="input-role" required>
              <option value="Medewerker">Medewerker</option>
              <option value="Senior Medewerker">Senior Medewerker</option>
              <option value="Assistent Manager">Assistent Manager</option>
              <option value="Manager">Manager</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Telefoonnummer <span class="optional">(optioneel)</span></label>
            <input type="tel" class="form-input" id="input-phone" placeholder="+31 6 12345678">
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn-cancel" id="btn-cancel">Annuleren</button>
          <button type="submit" class="btn-submit" id="btn-submit">Toevoegen</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Confirmation Modal -->
  <div class="modal-backdrop" id="modal-delete">
    <div class="modal modal-sm">
      <div class="modal-body" style="text-align:center;padding:2rem 1.5rem;">
        <div style="font-size:2.5rem;margin-bottom:0.75rem;">‚ö†Ô∏è</div>
        <h3 style="font-family:'Plus Jakarta Sans',sans-serif;font-weight:700;font-size:1.05rem;margin-bottom:0.35rem;">Medewerker verwijderen?</h3>
        <p id="delete-msg" style="font-size:0.85rem;color:var(--sanadome-text-soft);margin-bottom:1.25rem;">Weet je zeker dat je deze medewerker wilt verwijderen? Dit kan niet ongedaan worden.</p>
        <div style="display:flex;gap:0.5rem;justify-content:center;">
          <button type="button" class="btn-cancel" id="btn-cancel-delete">Annuleren</button>
          <button type="button" class="btn-danger" id="btn-confirm-delete">Verwijderen</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Password Success Modal -->
  <div class="modal-backdrop" id="modal-password">
    <div class="modal modal-sm">
      <div class="modal-body" style="text-align:center;padding:2rem 1.5rem;">
        <div style="font-size:2.5rem;margin-bottom:0.75rem;">‚úÖ</div>
        <h3 style="font-family:'Plus Jakarta Sans',sans-serif;font-weight:700;font-size:1.05rem;margin-bottom:0.15rem;">Medewerker aangemaakt</h3>
        <p id="pw-success-info" style="font-size:0.85rem;color:var(--sanadome-text-soft);margin-bottom:0.25rem;"></p>
        <div class="password-display">
          <code id="pw-display-value"></code>
          <button type="button" class="btn-copy" id="btn-copy-pw">Kopi√´ren</button>
        </div>
        <p class="pw-warning">‚ö†Ô∏è Sla dit wachtwoord op. Het wordt niet meer getoond.</p>
        <button type="button" class="btn-submit" id="btn-close-pw" style="width:100%;">Sluiten</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>
  <script>
    (function() {
      /* ‚îÄ‚îÄ Config ‚îÄ‚îÄ */
      var supabaseUrl = window.SUPABASE_URL;
      var supabaseKey = window.SUPABASE_ANON_KEY || window.SUPABASE_PUBLISHABLE_KEY;
      var serviceRoleKey = window.SUPABASE_SERVICE_ROLE_KEY;

      if (!supabaseUrl || !supabaseKey) { window.location.href = 'index.html'; return; }

      var sb = window.supabase.createClient(supabaseUrl, supabaseKey);
      var adminSb = serviceRoleKey
        ? window.supabase.createClient(supabaseUrl, serviceRoleKey, { auth: { autoRefreshToken: false, persistSession: false } })
        : null;

      /* ‚îÄ‚îÄ State ‚îÄ‚îÄ */
      var allUsers = [];
      var currentFilter = 'all';
      var searchQuery = '';
      var editingUserId = null;
      var deletingUserId = null;
      var createdPassword = '';
      var currentUserId = null;

      var ROLES = ['Medewerker', 'Senior Medewerker', 'Assistent Manager', 'Manager'];

      /* ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ */
      var grid = document.getElementById('users-grid');
      var statsRow = document.getElementById('stats-row');
      var filterPills = document.getElementById('filter-pills');
      var filterSearch = document.getElementById('filter-search');
      var modalUser = document.getElementById('modal-user');
      var modalDelete = document.getElementById('modal-delete');
      var modalPassword = document.getElementById('modal-password');
      var userForm = document.getElementById('user-form');
      var toastEl = document.getElementById('toast');

      /* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ */
      function escapeHtml(s) {
        if (!s) return '';
        return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
      }

      function roleSlug(role) { return (role || 'medewerker').toLowerCase().replace(/\s+/g, '-'); }

      function generatePassword() {
        var upper = 'ABCDEFGHJKLMNPQRSTUVWXYZ';
        var lower = 'abcdefghjkmnpqrstuvwxyz';
        var digits = '23456789';
        var special = '!@#$%&*?';
        var all = upper + lower + digits + special;
        var pw = '';
        pw += upper[Math.floor(Math.random() * upper.length)];
        pw += lower[Math.floor(Math.random() * lower.length)];
        pw += digits[Math.floor(Math.random() * digits.length)];
        pw += special[Math.floor(Math.random() * special.length)];
        for (var i = 4; i < 14; i++) pw += all[Math.floor(Math.random() * all.length)];
        return pw.split('').sort(function() { return 0.5 - Math.random(); }).join('');
      }

      function showToast(msg, type) {
        toastEl.textContent = msg;
        toastEl.className = 'toast ' + (type || 'success');
        setTimeout(function() { toastEl.classList.add('show'); }, 10);
        setTimeout(function() { toastEl.classList.remove('show'); }, 4000);
      }

      function openModal(el) { el.classList.add('active'); }
      function closeModal(el) { el.classList.remove('active'); }

      function copyToClipboard(text) {
        if (navigator.clipboard) {
          navigator.clipboard.writeText(text).then(function() { showToast('Gekopieerd!'); });
        } else {
          var ta = document.createElement('textarea');
          ta.value = text; document.body.appendChild(ta); ta.select();
          document.execCommand('copy'); document.body.removeChild(ta);
          showToast('Gekopieerd!');
        }
      }

      function userRole(u) { return (u.user_metadata && u.user_metadata.role) || 'Medewerker'; }
      function userName(u) {
        return (u.user_metadata && u.user_metadata.full_name)
          || (u.email ? u.email.split('@')[0] : 'Onbekend');
      }
      function userInitials(u) {
        var n = userName(u);
        return n.split(/\s+/).map(function(s) { return (s[0] || '').toUpperCase(); }).slice(0, 2).join('');
      }

      /* ‚îÄ‚îÄ Auth check ‚îÄ‚îÄ */
      sb.auth.getSession().then(function(res) {
        var session = res.data.session;
        if (!session || !session.user) { window.location.href = 'index.html'; return; }

        return sb.auth.getUser().then(function(userRes) {
          if (!userRes || userRes.error || !userRes.data || !userRes.data.user) {
            window.location.href = 'index.html'; return;
          }
          var user = userRes.data.user;
          currentUserId = user.id;
          var email = user.email || '‚Äî';
          var name = user.user_metadata && user.user_metadata.full_name
            ? user.user_metadata.full_name
            : (email !== '‚Äî' ? email.split('@')[0] : 'Medewerker');

          document.getElementById('user-name').textContent = name;
          var ini = name.split(/\s+/).map(function(s) { return (s[0] || '').toUpperCase(); }).slice(0, 2).join('');
          var avatarUrl = user.user_metadata && user.user_metadata.avatar_url;
          if (avatarUrl) {
            document.getElementById('user-avatar').innerHTML = '<img src="' + avatarUrl + '" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">';
          } else {
            document.getElementById('user-avatar').textContent = ini;
          }

          // Permission enforcement
          var myRole = (user.user_metadata && user.user_metadata.role) || 'Medewerker';
          function getDefaultPerms(role) {
            var ALL = ['dashboard.nieuws','dashboard.berichten','dashboard.aanvragen','dashboard.contactgegevens','dashboard.dienstverband','dashboard.rooster','nav.rooster','nav.verlof','nav.documenten','nav.berichten','nav.gegevens','nav.hr','medewerkers.bekijken','medewerkers.aanmaken','medewerkers.bewerken','medewerkers.verwijderen','nieuws.bekijken','nieuws.aanmaken','nieuws.bewerken','nieuws.verwijderen','rechten.bekijken','rechten.bewerken','debiteuren.bekijken','debiteuren.beheren','debiteuren.importeren'];
            var p = {};
            ALL.forEach(function(k) {
              if (role === 'Manager') p[k] = true;
              else if (role === 'Assistent Manager') p[k] = k !== 'rechten.bewerken' && k !== 'medewerkers.verwijderen';
              else if (role === 'Senior Medewerker') p[k] = k.startsWith('dashboard.') || k.startsWith('nav.') || k === 'medewerkers.bekijken' || k === 'nieuws.bekijken' || k === 'debiteuren.bekijken';
              else p[k] = k.startsWith('dashboard.') || k.startsWith('nav.');
            });
            return p;
          }
          sb.from('role_permissions').select('permission, granted').eq('role', myRole).then(function(pr) {
            var perms = {};
            if (!pr.error && pr.data && pr.data.length > 0) {
              pr.data.forEach(function(r) { perms[r.permission] = r.granted; });
            } else {
              perms = getDefaultPerms(myRole);
            }
            return sb.from('user_permissions').select('permission, granted').eq('user_id', user.id).then(function(upr) {
              if (!upr.error && upr.data && upr.data.length > 0) {
                upr.data.forEach(function(r) { perms[r.permission] = r.granted; });
              }
              return perms;
            }).catch(function() { return perms; });
          }).then(function(perms) {
            // Check page access
            if (perms['medewerkers.bekijken'] === false) {
              window.location.href = 'dashboard.html'; return;
            }
            // Hide sidebar items
            document.querySelectorAll('[data-permission]').forEach(function(el) {
              if (perms[el.getAttribute('data-permission')] === false) el.style.display = 'none';
            });
            // Hide add button if no create permission
            if (perms['medewerkers.aanmaken'] === false) {
              document.getElementById('btn-add-user').style.display = 'none';
            }
            // Store permissions for card rendering
            window._userPerms = perms;
          }).catch(function() { window._userPerms = getDefaultPerms(myRole); });

          // Show admin warning if no service key
          if (!adminSb) {
            document.getElementById('admin-warning').style.display = 'flex';
            document.getElementById('btn-add-user').disabled = true;
            document.getElementById('btn-add-user').style.opacity = '0.5';
            grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üîí</div><h3>Geen toegang</h3><p>Service role key is vereist voor gebruikersbeheer.</p></div>';
            return;
          }

          initPage();
        });
      }).catch(function() { window.location.href = 'index.html'; });

      /* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
      function initPage() {
        // Logout
        document.getElementById('btn-logout').addEventListener('click', function(e) {
          e.preventDefault();
          sb.auth.signOut().then(function() { window.location.href = 'index.html'; });
        });

        // Load users
        loadUsers();

        // Search
        var searchTimer;
        filterSearch.addEventListener('input', function() {
          clearTimeout(searchTimer);
          searchTimer = setTimeout(function() {
            searchQuery = filterSearch.value.trim().toLowerCase();
            renderUsers();
          }, 250);
        });

        // Add user button
        document.getElementById('btn-add-user').addEventListener('click', function() {
          openCreateModal();
        });

        // Modal close buttons
        document.getElementById('modal-close').addEventListener('click', function() { closeModal(modalUser); });
        document.getElementById('btn-cancel').addEventListener('click', function() { closeModal(modalUser); });
        document.getElementById('btn-cancel-delete').addEventListener('click', function() { closeModal(modalDelete); });
        document.getElementById('btn-close-pw').addEventListener('click', function() { closeModal(modalPassword); });

        // Close modals on backdrop click
        [modalUser, modalDelete, modalPassword].forEach(function(m) {
          m.addEventListener('click', function(e) { if (e.target === m) closeModal(m); });
        });

        // Password toggle
        document.getElementById('pw-toggle').addEventListener('click', function() {
          var inp = document.getElementById('input-password');
          inp.type = inp.type === 'password' ? 'text' : 'password';
        });

        // Password regenerate
        document.getElementById('pw-regen').addEventListener('click', function() {
          document.getElementById('input-password').value = generatePassword();
          document.getElementById('input-password').type = 'text';
        });

        // Copy password
        document.getElementById('btn-copy-pw').addEventListener('click', function() {
          copyToClipboard(document.getElementById('pw-display-value').textContent);
        });

        // Delete confirm
        document.getElementById('btn-confirm-delete').addEventListener('click', function() {
          if (deletingUserId) deleteUser(deletingUserId);
        });

        // Form submit
        userForm.addEventListener('submit', function(e) {
          e.preventDefault();
          if (editingUserId) {
            updateUser(editingUserId);
          } else {
            createUser();
          }
        });
      }

      /* ‚îÄ‚îÄ Load users ‚îÄ‚îÄ */
      function loadUsers() {
        adminSb.auth.admin.listUsers({ perPage: 1000 }).then(function(res) {
          if (res.error) {
            showToast('Fout bij laden: ' + res.error.message, 'error');
            return;
          }
          allUsers = res.data.users || [];
          renderFilters();
          renderStats();
          renderUsers();
        }).catch(function(err) {
          showToast('Fout bij laden: ' + err.message, 'error');
        });
      }

      /* ‚îÄ‚îÄ Render stats ‚îÄ‚îÄ */
      function renderStats() {
        var counts = { total: allUsers.length };
        ROLES.forEach(function(r) { counts[r] = 0; });
        allUsers.forEach(function(u) {
          var r = userRole(u);
          if (counts[r] !== undefined) counts[r]++;
        });

        statsRow.innerHTML =
          '<div class="stat-pill">Totaal <span class="stat-pill-count">' + counts.total + '</span></div>' +
          ROLES.map(function(r) {
            return '<div class="stat-pill">' + r + ' <span class="stat-pill-count">' + (counts[r] || 0) + '</span></div>';
          }).join('');
      }

      /* ‚îÄ‚îÄ Render filter pills ‚îÄ‚îÄ */
      function renderFilters() {
        var html = '<button type="button" class="filter-pill' + (currentFilter === 'all' ? ' active' : '') + '" data-role="all">Alle</button>';
        ROLES.forEach(function(r) {
          html += '<button type="button" class="filter-pill' + (currentFilter === r ? ' active' : '') + '" data-role="' + escapeHtml(r) + '">' + escapeHtml(r) + '</button>';
        });
        filterPills.innerHTML = html;

        // Attach listeners
        filterPills.querySelectorAll('.filter-pill').forEach(function(pill) {
          pill.addEventListener('click', function() {
            currentFilter = pill.getAttribute('data-role');
            filterPills.querySelectorAll('.filter-pill').forEach(function(p) { p.classList.remove('active'); });
            pill.classList.add('active');
            renderUsers();
          });
        });
      }

      /* ‚îÄ‚îÄ Render user cards ‚îÄ‚îÄ */
      function renderUsers() {
        var _p = window._userPerms || {};
        var canEdit = _p['medewerkers.bewerken'] !== false;
        var canDelete = _p['medewerkers.verwijderen'] !== false;
        var filtered = allUsers.filter(function(u) {
          var role = userRole(u);
          var matchRole = currentFilter === 'all' || role === currentFilter;
          var name = userName(u).toLowerCase();
          var email = (u.email || '').toLowerCase();
          var matchSearch = !searchQuery || name.indexOf(searchQuery) !== -1 || email.indexOf(searchQuery) !== -1;
          return matchRole && matchSearch;
        });

        if (filtered.length === 0) {
          grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üë•</div><h3>Geen medewerkers gevonden</h3><p>Pas je filters aan of voeg een nieuwe medewerker toe.</p></div>';
          return;
        }

        grid.innerHTML = filtered.map(function(u) {
          var name = userName(u);
          var initials = userInitials(u);
          var role = userRole(u);
          var slug = roleSlug(role);
          var email = u.email || '‚Äî';
          var phone = (u.user_metadata && u.user_metadata.phone) || '';
          var created = new Date(u.created_at).toLocaleDateString('nl-NL', { day: 'numeric', month: 'short', year: 'numeric' });
          var isSelf = u.id === currentUserId;

          return '<div class="user-card" data-role="' + slug + '">' +
            '<div class="user-card-avatar">' + escapeHtml(initials) + '</div>' +
            '<span class="role-badge role-' + slug + '">' + escapeHtml(role) + '</span>' +
            '<div class="user-card-name">' + escapeHtml(name) + (isSelf ? ' <span style="font-size:0.7rem;color:var(--sanadome-blue);">(jij)</span>' : '') + '</div>' +
            '<div class="user-card-email">' + escapeHtml(email) + '</div>' +
            (phone ? '<div class="user-card-phone">' + escapeHtml(phone) + '</div>' : '') +
            '<div class="user-card-meta">Aangemaakt: ' + created + '</div>' +
            '<div class="user-card-actions">' +
              (canEdit ? '<button type="button" class="card-action-btn edit-btn" data-id="' + u.id + '" title="Bewerken"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg> Bewerken</button>' : '') +
              (canDelete ? '<button type="button" class="card-action-btn delete-btn" data-id="' + u.id + '" data-name="' + escapeHtml(name) + '" title="Verwijderen"' + (isSelf ? ' disabled style="opacity:0.4;cursor:not-allowed;"' : '') + '><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg> Verwijderen</button>' : '') +
            '</div>' +
          '</div>';
        }).join('');

        // Attach card action listeners
        grid.querySelectorAll('.edit-btn').forEach(function(btn) {
          btn.addEventListener('click', function() { openEditModal(btn.getAttribute('data-id')); });
        });
        grid.querySelectorAll('.delete-btn').forEach(function(btn) {
          if (!btn.disabled) {
            btn.addEventListener('click', function() {
              openDeleteModal(btn.getAttribute('data-id'), btn.getAttribute('data-name'));
            });
          }
        });
      }

      /* ‚îÄ‚îÄ Open create modal ‚îÄ‚îÄ */
      function openCreateModal() {
        editingUserId = null;
        document.getElementById('modal-title').textContent = 'Nieuwe medewerker';
        document.getElementById('btn-submit').textContent = 'Toevoegen';
        document.getElementById('password-group').style.display = '';
        document.getElementById('pw-hint').textContent = 'Min. 8 tekens ¬∑ Wordt getoond na aanmaken';
        document.getElementById('input-password').required = true;

        userForm.reset();
        document.getElementById('input-password').value = generatePassword();
        document.getElementById('input-password').type = 'text';
        document.getElementById('input-email').removeAttribute('disabled');
        openModal(modalUser);
      }

      /* ‚îÄ‚îÄ Open edit modal ‚îÄ‚îÄ */
      function openEditModal(userId) {
        var user = allUsers.find(function(u) { return u.id === userId; });
        if (!user) return;

        editingUserId = userId;
        document.getElementById('modal-title').textContent = 'Medewerker bewerken';
        document.getElementById('btn-submit').textContent = 'Opslaan';
        document.getElementById('password-group').style.display = '';
        document.getElementById('pw-hint').textContent = 'Laat leeg om het wachtwoord niet te wijzigen';
        document.getElementById('input-password').required = false;
        document.getElementById('input-password').value = '';
        document.getElementById('input-password').type = 'password';
        document.getElementById('input-password').placeholder = 'Laat leeg om niet te wijzigen';

        document.getElementById('input-name').value = userName(user);
        document.getElementById('input-email').value = user.email || '';
        document.getElementById('input-email').setAttribute('disabled', 'disabled');
        document.getElementById('input-role').value = userRole(user);
        document.getElementById('input-phone').value = (user.user_metadata && user.user_metadata.phone) || '';

        openModal(modalUser);
      }

      /* ‚îÄ‚îÄ Open delete modal ‚îÄ‚îÄ */
      function openDeleteModal(userId, name) {
        deletingUserId = userId;
        document.getElementById('delete-msg').innerHTML =
          'Weet je zeker dat je <strong>' + escapeHtml(name) + '</strong> wilt verwijderen? Dit kan niet ongedaan worden.';
        openModal(modalDelete);
      }

      /* ‚îÄ‚îÄ Create user ‚îÄ‚îÄ */
      function createUser() {
        var submitBtn = document.getElementById('btn-submit');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Bezig‚Ä¶';

        var fullName = document.getElementById('input-name').value.trim();
        var email = document.getElementById('input-email').value.trim();
        var password = document.getElementById('input-password').value;
        var role = document.getElementById('input-role').value;
        var phone = document.getElementById('input-phone').value.trim();

        if (password.length < 8) {
          showToast('Wachtwoord moet minimaal 8 tekens zijn.', 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Toevoegen';
          return;
        }

        createdPassword = password;

        adminSb.auth.admin.createUser({
          email: email,
          password: password,
          email_confirm: true,
          user_metadata: {
            full_name: fullName,
            role: role,
            phone: phone || null
          }
        }).then(function(res) {
          if (res.error) {
            showToast('Fout: ' + res.error.message, 'error');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Toevoegen';
            return;
          }

          closeModal(modalUser);
          showToast(fullName + ' is aangemaakt!');

          // Show password modal
          document.getElementById('pw-success-info').textContent = fullName + ' ¬∑ ' + email;
          document.getElementById('pw-display-value').textContent = createdPassword;
          openModal(modalPassword);

          loadUsers();
          submitBtn.disabled = false;
          submitBtn.textContent = 'Toevoegen';
        }).catch(function(err) {
          showToast('Fout: ' + err.message, 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Toevoegen';
        });
      }

      /* ‚îÄ‚îÄ Update user ‚îÄ‚îÄ */
      function updateUser(userId) {
        var submitBtn = document.getElementById('btn-submit');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Bezig‚Ä¶';

        var fullName = document.getElementById('input-name').value.trim();
        var role = document.getElementById('input-role').value;
        var phone = document.getElementById('input-phone').value.trim();
        var password = document.getElementById('input-password').value;

        var updateData = {
          user_metadata: {
            full_name: fullName,
            role: role,
            phone: phone || null
          }
        };

        if (password && password.length > 0) {
          if (password.length < 8) {
            showToast('Wachtwoord moet minimaal 8 tekens zijn.', 'error');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Opslaan';
            return;
          }
          updateData.password = password;
        }

        adminSb.auth.admin.updateUserById(userId, updateData).then(function(res) {
          if (res.error) {
            showToast('Fout: ' + res.error.message, 'error');
            submitBtn.disabled = false;
            submitBtn.textContent = 'Opslaan';
            return;
          }

          closeModal(modalUser);
          showToast(fullName + ' is bijgewerkt!');
          loadUsers();
          submitBtn.disabled = false;
          submitBtn.textContent = 'Opslaan';
        }).catch(function(err) {
          showToast('Fout: ' + err.message, 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Opslaan';
        });
      }

      /* ‚îÄ‚îÄ Delete user ‚îÄ‚îÄ */
      function deleteUser(userId) {
        var confirmBtn = document.getElementById('btn-confirm-delete');
        confirmBtn.disabled = true;
        confirmBtn.textContent = 'Bezig‚Ä¶';

        adminSb.auth.admin.deleteUser(userId).then(function(res) {
          if (res.error) {
            showToast('Fout: ' + res.error.message, 'error');
            confirmBtn.disabled = false;
            confirmBtn.textContent = 'Verwijderen';
            return;
          }

          closeModal(modalDelete);
          showToast('Medewerker verwijderd.');
          deletingUserId = null;
          loadUsers();
          confirmBtn.disabled = false;
          confirmBtn.textContent = 'Verwijderen';
        }).catch(function(err) {
          showToast('Fout: ' + err.message, 'error');
          confirmBtn.disabled = false;
          confirmBtn.textContent = 'Verwijderen';
        });
      }

    })();
  </script>
</body>
</html>
