<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nieuwsbeheer ¬∑ MijnSanadome</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300..800;1,9..40,300..800&family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="config.js"></script>
  <style>
    :root {
      --sanadome-blue: #3b82c4;
      --sanadome-blue-light: #60a5e8;
      --sanadome-blue-pale: #eff6ff;
      --sanadome-blue-mist: #f0f7ff;
      --sanadome-text: #0f172a;
      --sanadome-text-soft: #64748b;
      --sanadome-border: #e2e8f0;
      --white: #ffffff;
      --radius: 16px;
      --radius-sm: 10px;
      --sidebar-w: 270px;
      --topbar-h: 68px;
      --shadow-card: 0 1px 4px rgba(0,0,0,.06), 0 1px 2px rgba(0,0,0,.04);
      --shadow-card-hover: 0 8px 24px rgba(0,0,0,.08);
      --shadow-elevated: 0 12px 36px rgba(0,0,0,.12);
      --gradient-primary: linear-gradient(135deg, #3b82c4 0%, #60a5e8 100%);
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #f4f7fb; color: var(--sanadome-text); min-height: 100vh; }

    /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
    .sidebar {
      position: fixed; top: 0; left: 0; width: var(--sidebar-w); height: 100vh;
      background: var(--white); border-right: 1px solid var(--sanadome-border);
      display: flex; flex-direction: column; z-index: 100;
    }
    .sidebar-logo {
      padding: 24px 24px 20px; display: flex; align-items: center; gap: 14px;
      border-bottom: 1px solid var(--sanadome-border);
    }
    .logo-icon {
      width: 42px; height: 42px; background: var(--gradient-primary); border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
    }
    .logo-icon svg { width: 22px; height: 22px; color: white; }
    .logo-text h1 { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.05rem; font-weight: 700; color: var(--sanadome-text); }
    .logo-text span { font-size: 0.72rem; color: var(--sanadome-text-soft); font-weight: 500; }
    .sidebar-nav { flex: 1; padding: 16px 14px; overflow-y: auto; }
    .nav-label { font-size: 0.68rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em; color: var(--sanadome-text-soft); padding: 16px 12px 6px; }
    .nav-item {
      display: flex; align-items: center; gap: 12px; padding: 10px 14px; border-radius: var(--radius-sm);
      color: var(--sanadome-text-soft); text-decoration: none; font-size: 0.88rem; font-weight: 500;
      transition: all .15s; margin-bottom: 2px; cursor: pointer;
    }
    .nav-item:hover { background: var(--sanadome-blue-pale); color: var(--sanadome-blue); }
    .nav-item.active { background: var(--sanadome-blue-pale); color: var(--sanadome-blue); font-weight: 600; }
    .nav-item svg { width: 20px; height: 20px; flex-shrink: 0; }
    /* ‚îÄ‚îÄ Topbar ‚îÄ‚îÄ */
    .app-main { margin-left: var(--sidebar-w); min-height: 100vh; }
    .topbar {
      height: var(--topbar-h);
      background: rgba(255,255,255,0.85); backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(226,232,240,0.6);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem; gap: 1rem; position: sticky; top: 0; z-index: 50;
    }
    .topbar-search-wrap { position: relative; flex: 1; max-width: 380px; }
    .topbar-search {
      width: 100%; padding: 0.55rem 1rem 0.55rem 2.75rem;
      font-family: inherit; font-size: 0.875rem; color: var(--sanadome-text);
      background: #f1f5f9; border: 1.5px solid transparent;
      border-radius: var(--radius-sm); outline: none; transition: all 0.2s ease;
    }
    .topbar-search::placeholder { color: var(--sanadome-text-soft); }
    .topbar-search:focus { background: var(--white); border-color: var(--sanadome-blue); box-shadow: 0 0 0 3px rgba(59,130,196,0.1); }
    .topbar-search-wrap::before {
      content: ''; position: absolute; left: 0.75rem; top: 50%; transform: translateY(-50%);
      width: 18px; height: 18px; border: 2px solid var(--sanadome-text-soft); border-radius: 50%; opacity: 0.5;
    }
    .topbar-search-wrap::after {
      content: ''; position: absolute; left: 1.45rem; top: 58%;
      width: 6px; height: 2px; background: var(--sanadome-text-soft);
      transform: rotate(45deg); opacity: 0.5;
    }
    .topbar-actions { display: flex; align-items: center; gap: 0.5rem; }
    .topbar-icon-btn {
      width: 40px; height: 40px; border: none; background: transparent;
      border-radius: var(--radius-sm); color: var(--sanadome-text-soft);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: all 0.15s ease; position: relative;
    }
    .topbar-icon-btn:hover { background: var(--sanadome-blue-mist); color: var(--sanadome-blue); }
    .topbar-icon-btn svg { width: 20px; height: 20px; }
    .topbar-user { display: flex; align-items: center; gap: 0.75rem; padding: 0.35rem 0.5rem 0.35rem 0.75rem; border-radius: var(--radius-sm); margin-left: 0.5rem; border: 1px solid transparent; transition: background 0.15s; text-decoration: none; color: inherit; }
    .topbar-user:hover { background: var(--sanadome-blue-mist); }
    .topbar-avatar {
      width: 38px; height: 38px; border-radius: 50%; overflow: hidden;
      background: var(--gradient-primary); color: var(--white);
      font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 600; font-size: 0.85rem;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
      box-shadow: 0 2px 8px rgba(59,130,196,0.25);
    }
    .topbar-user-info { text-align: left; }
    .topbar-user-name { font-family: 'Plus Jakarta Sans', sans-serif; font-weight: 600; font-size: 0.9rem; color: var(--sanadome-text); display: block; line-height: 1.3; }
    .topbar-user-role { font-size: 0.75rem; color: var(--sanadome-text-soft); display: block; }
    .btn-logout {
      padding: 0.45rem 0.85rem; font-size: 0.8rem; font-family: inherit; font-weight: 600;
      color: var(--white); background: var(--gradient-primary); border: none;
      border-radius: var(--radius-sm); cursor: pointer; margin-left: 0.5rem;
      transition: all 0.2s ease; box-shadow: 0 2px 8px rgba(59,130,196,0.2);
    }
    .btn-logout:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(59,130,196,0.3); }

    /* ‚îÄ‚îÄ Main content ‚îÄ‚îÄ */
    .main-content { padding: 32px 36px 48px; }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .page-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 28px; flex-wrap: wrap; gap: 16px;
    }
    .page-header h2 { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.6rem; font-weight: 800; color: var(--sanadome-text); }
    .page-header p { font-size: 0.88rem; color: var(--sanadome-text-soft); margin-top: 2px; }
    .btn-primary {
      display: inline-flex; align-items: center; gap: 8px; padding: 11px 22px;
      background: var(--gradient-primary); color: white; border: none; border-radius: var(--radius-sm);
      font-weight: 600; font-size: 0.88rem; cursor: pointer; transition: all .2s;
      font-family: inherit; box-shadow: 0 2px 8px rgba(59,130,196,0.25);
    }
    .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); box-shadow: 0 4px 16px rgba(59,130,196,0.3); }
    .btn-primary svg { width: 18px; height: 18px; }

    /* ‚îÄ‚îÄ Toolbar ‚îÄ‚îÄ */
    .toolbar {
      display: flex; align-items: center; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;
    }
    .search-box {
      position: relative; flex: 1; min-width: 220px;
    }
    .search-box input {
      width: 100%; padding: 10px 14px 10px 40px; border: 1.5px solid var(--sanadome-border);
      border-radius: var(--radius-sm); font-size: 0.88rem; font-family: inherit;
      background: var(--white); transition: border-color .2s;
    }
    .search-box input:focus { outline: none; border-color: var(--sanadome-blue); }
    .search-box svg {
      position: absolute; left: 13px; top: 50%; transform: translateY(-50%);
      width: 18px; height: 18px; color: var(--sanadome-text-soft);
    }
    .filter-btn {
      padding: 10px 18px; border: 1.5px solid var(--sanadome-border); background: var(--white);
      border-radius: var(--radius-sm); font-size: 0.85rem; font-weight: 500; cursor: pointer;
      color: var(--sanadome-text-soft); transition: all .2s; font-family: inherit;
    }
    .filter-btn:hover, .filter-btn.active { border-color: var(--sanadome-blue); color: var(--sanadome-blue); background: var(--sanadome-blue-pale); }

    /* ‚îÄ‚îÄ Setup banner ‚îÄ‚îÄ */
    .setup-banner {
      background: linear-gradient(135deg, #fefce8, #fef9c3); border: 1.5px solid #f59e0b;
      border-radius: var(--radius); padding: 20px 24px; margin-bottom: 24px;
    }
    .setup-banner h3 { font-size: 0.95rem; color: #92400e; margin-bottom: 8px; }
    .setup-banner p { font-size: 0.82rem; color: #a16207; line-height: 1.5; }
    .setup-banner pre {
      background: #1e293b; color: #e2e8f0; padding: 14px 18px; border-radius: 10px;
      margin: 12px 0; font-size: 0.78rem; overflow-x: auto; line-height: 1.6;
    }
    .setup-banner button {
      padding: 8px 18px; background: #f59e0b; color: white; border: none; border-radius: 8px;
      font-weight: 600; font-size: 0.82rem; cursor: pointer; font-family: inherit;
    }

    /* ‚îÄ‚îÄ News grid ‚îÄ‚îÄ */
    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
      gap: 20px;
    }
    .news-card {
      background: var(--white); border-radius: var(--radius); border: 1.5px solid var(--sanadome-border);
      overflow: hidden; transition: all .2s; cursor: default;
    }
    .news-card:hover { box-shadow: var(--shadow-card-hover); border-color: var(--sanadome-blue); }
    .news-card-thumb {
      width: 100%; height: 180px; object-fit: cover; background: var(--sanadome-blue-pale);
      display: flex; align-items: center; justify-content: center; color: var(--sanadome-text-soft);
      font-size: 2.5rem; position: relative;
    }
    .news-card-thumb img { width: 100%; height: 100%; object-fit: cover; }
    .news-card-status {
      position: absolute; top: 12px; right: 12px; padding: 4px 12px; border-radius: 20px;
      font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.04em;
    }
    .status-gepubliceerd { background: #dcfce7; color: #166534; }
    .status-concept { background: #fef3c7; color: #92400e; }
    .news-card-body { padding: 18px 20px; }
    .news-card-body h3 {
      font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.05rem; font-weight: 700;
      color: var(--sanadome-text); margin-bottom: 6px; line-height: 1.3;
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
    }
    .news-card-promo {
      font-size: 0.82rem; color: var(--sanadome-text-soft); line-height: 1.5;
      display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;
      margin-bottom: 12px;
    }
    .news-card-meta {
      display: flex; align-items: center; gap: 12px; font-size: 0.75rem; color: var(--sanadome-text-soft);
    }
    .news-card-meta span { display: flex; align-items: center; gap: 4px; }
    .news-card-meta svg { width: 14px; height: 14px; }
    .news-card-actions {
      display: flex; gap: 8px; padding: 12px 20px 16px; border-top: 1px solid var(--sanadome-border);
    }
    .card-btn {
      flex: 1; padding: 8px 0; border: 1.5px solid var(--sanadome-border); border-radius: 8px;
      background: var(--white); font-size: 0.8rem; font-weight: 600; cursor: pointer;
      display: flex; align-items: center; justify-content: center; gap: 6px;
      color: var(--sanadome-text-soft); transition: all .15s; font-family: inherit;
    }
    .card-btn:hover { border-color: var(--sanadome-blue); color: var(--sanadome-blue); background: var(--sanadome-blue-pale); }
    .card-btn.delete:hover { border-color: #ef4444; color: #ef4444; background: #fef2f2; }
    .card-btn svg { width: 15px; height: 15px; }

    .empty-state {
      text-align: center; padding: 60px 20px; grid-column: 1 / -1;
    }
    .empty-state-icon { font-size: 3rem; margin-bottom: 12px; }
    .empty-state h3 { font-size: 1.1rem; color: var(--sanadome-text); margin-bottom: 6px; }
    .empty-state p { font-size: 0.88rem; color: var(--sanadome-text-soft); }

    /* ‚îÄ‚îÄ Modal overlay ‚îÄ‚îÄ */
    .modal-overlay {
      display: none; position: fixed; inset: 0; background: rgba(15,23,42,0.45);
      backdrop-filter: blur(4px); z-index: 500; align-items: center; justify-content: center;
    }
    .modal-overlay.open { display: flex; }
    .modal {
      background: var(--white); border-radius: 20px; width: 94vw; max-width: 820px;
      max-height: 92vh; overflow-y: auto; box-shadow: var(--shadow-elevated);
      animation: modalIn .2s ease;
    }
    @keyframes modalIn { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }
    .modal-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 22px 28px; border-bottom: 1px solid var(--sanadome-border);
    }
    .modal-header h2 { font-family: 'Plus Jakarta Sans', sans-serif; font-size: 1.15rem; font-weight: 700; }
    .modal-close {
      width: 36px; height: 36px; border: none; background: #f1f5f9; border-radius: 10px;
      cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all .15s;
    }
    .modal-close:hover { background: #fee2e2; color: #ef4444; }
    .modal-close svg { width: 18px; height: 18px; }
    .modal-body { padding: 24px 28px 28px; }

    /* ‚îÄ‚îÄ Form ‚îÄ‚îÄ */
    .form-group { margin-bottom: 18px; }
    .form-group label { display: block; font-size: 0.82rem; font-weight: 600; color: var(--sanadome-text); margin-bottom: 6px; }
    .form-group input, .form-group textarea, .form-group select {
      width: 100%; padding: 10px 14px; border: 1.5px solid var(--sanadome-border);
      border-radius: var(--radius-sm); font-size: 0.88rem; font-family: inherit;
      transition: border-color .2s; background: var(--white);
    }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
      outline: none; border-color: var(--sanadome-blue);
    }
    .form-group textarea { resize: vertical; min-height: 80px; }
    .form-row { display: flex; gap: 16px; }
    .form-row .form-group { flex: 1; }
    .form-hint { font-size: 0.75rem; color: var(--sanadome-text-soft); margin-top: 4px; }

    .thumb-upload-zone {
      width: 100%; min-height: 180px; border-radius: var(--radius-sm); background: #f8fafc;
      border: 2px dashed var(--sanadome-border); display: flex; flex-direction: column;
      align-items: center; justify-content: center; overflow: hidden; margin-top: 8px;
      transition: all .2s; cursor: pointer; position: relative; gap: 8px; padding: 20px;
    }
    .thumb-upload-zone:hover, .thumb-upload-zone.dragover { border-color: var(--sanadome-blue); background: var(--sanadome-blue-pale); }
    .thumb-upload-zone img { width: 100%; height: 180px; object-fit: cover; border-radius: 6px; }
    .thumb-upload-zone .upload-icon { color: var(--sanadome-text-soft); }
    .thumb-upload-zone .upload-icon svg { width: 36px; height: 36px; }
    .thumb-upload-zone .upload-text { font-size: 0.82rem; color: var(--sanadome-text-soft); text-align: center; }
    .thumb-upload-zone .upload-text strong { color: var(--sanadome-blue); }
    .thumb-upload-zone.has-image { padding: 0; }
    .thumb-remove {
      position: absolute; top: 8px; right: 8px; width: 28px; height: 28px;
      background: rgba(0,0,0,0.6); border: none; border-radius: 50%; cursor: pointer;
      display: flex; align-items: center; justify-content: center; color: white;
      font-size: 1rem; transition: all .15s; z-index: 2;
    }
    .thumb-remove:hover { background: #ef4444; }
    .upload-progress {
      width: 100%; height: 4px; background: var(--sanadome-border); border-radius: 2px;
      overflow: hidden; margin-top: 8px; display: none;
    }
    .upload-progress-bar { height: 100%; background: var(--gradient-primary); border-radius: 2px; transition: width .3s; width: 0; }

    /* ‚îÄ‚îÄ Rich text editor ‚îÄ‚îÄ */
    .editor-toolbar {
      display: flex; flex-wrap: wrap; gap: 2px; padding: 8px 10px;
      border: 1.5px solid var(--sanadome-border); border-bottom: none;
      border-radius: var(--radius-sm) var(--radius-sm) 0 0; background: #f8fafc;
    }
    .editor-toolbar button {
      width: 34px; height: 34px; border: none; background: none; border-radius: 6px;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      color: var(--sanadome-text-soft); transition: all .15s; font-family: inherit;
      font-size: 0.85rem; font-weight: 600;
    }
    .editor-toolbar button:hover { background: var(--sanadome-blue-pale); color: var(--sanadome-blue); }
    .editor-toolbar button.active { background: var(--sanadome-blue); color: white; }
    .editor-toolbar .sep { width: 1px; background: var(--sanadome-border); margin: 4px 6px; }
    .editor-toolbar button svg { width: 16px; height: 16px; }
    .editor-content {
      border: 1.5px solid var(--sanadome-border); border-top: 1px solid var(--sanadome-border);
      border-radius: 0 0 var(--radius-sm) var(--radius-sm); padding: 16px 18px;
      min-height: 220px; max-height: 400px; overflow-y: auto; font-size: 0.9rem;
      line-height: 1.7; color: var(--sanadome-text); outline: none;
      font-family: 'DM Sans', sans-serif;
    }
    .editor-content:focus { border-color: var(--sanadome-blue); }
    .editor-content h2 { font-size: 1.2rem; font-weight: 700; margin: 12px 0 6px; }
    .editor-content h3 { font-size: 1.05rem; font-weight: 600; margin: 10px 0 4px; }
    .editor-content ul, .editor-content ol { padding-left: 24px; margin: 8px 0; }
    .editor-content blockquote {
      border-left: 3px solid var(--sanadome-blue); padding-left: 14px;
      color: var(--sanadome-text-soft); margin: 10px 0; font-style: italic;
    }
    .editor-content a { color: var(--sanadome-blue); }
    .editor-content img { max-width: 100%; border-radius: 8px; margin: 8px 0; }

    /* ‚îÄ‚îÄ Bottom actions ‚îÄ‚îÄ */
    .modal-actions {
      display: flex; justify-content: flex-end; gap: 10px; padding-top: 16px;
      border-top: 1px solid var(--sanadome-border); margin-top: 8px;
    }
    .btn-secondary {
      padding: 10px 22px; border: 1.5px solid var(--sanadome-border); background: var(--white);
      border-radius: var(--radius-sm); font-weight: 600; font-size: 0.85rem; cursor: pointer;
      color: var(--sanadome-text-soft); font-family: inherit; transition: all .15s;
    }
    .btn-secondary:hover { border-color: var(--sanadome-blue); color: var(--sanadome-blue); }
    .btn-save {
      padding: 10px 28px; background: var(--gradient-primary); color: white; border: none;
      border-radius: var(--radius-sm); font-weight: 600; font-size: 0.85rem; cursor: pointer;
      font-family: inherit; transition: all .15s;
    }
    .btn-save:hover { opacity: 0.9; }
    .btn-save:disabled { opacity: 0.5; cursor: not-allowed; }

    /* ‚îÄ‚îÄ Delete modal ‚îÄ‚îÄ */
    .delete-modal { max-width: 440px; text-align: center; }
    .delete-modal .modal-body { padding: 32px 28px; }
    .delete-icon { width: 56px; height: 56px; background: #fef2f2; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 16px; }
    .delete-icon svg { width: 28px; height: 28px; color: #ef4444; }
    .delete-modal h3 { font-size: 1.05rem; margin-bottom: 8px; }
    .delete-modal p { font-size: 0.88rem; color: var(--sanadome-text-soft); margin-bottom: 20px; }
    .delete-actions { display: flex; gap: 10px; justify-content: center; }
    .btn-danger {
      padding: 10px 28px; background: #ef4444; color: white; border: none;
      border-radius: var(--radius-sm); font-weight: 600; font-size: 0.85rem; cursor: pointer;
      font-family: inherit; transition: all .15s;
    }
    .btn-danger:hover { background: #dc2626; }

    /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
    .toast {
      position: fixed; bottom: 28px; right: 28px; padding: 14px 22px;
      background: #1e293b; color: white; border-radius: 12px; font-size: 0.85rem;
      font-weight: 500; z-index: 9999; transform: translateY(80px); opacity: 0;
      transition: all .3s ease;
    }
    .toast.show { transform: translateY(0); opacity: 1; }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 768px) {
      .sidebar { display: none; }
      .app-main { margin-left: 0; }
      .main-content { padding: 20px 16px; }
      .topbar-search-wrap { max-width: 180px; }
      .news-grid { grid-template-columns: 1fr; }
      .modal { width: 98vw; max-height: 96vh; }
      .form-row { flex-direction: column; gap: 0; }
    }
  </style>
</head>
<body>

  <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ -->
  <aside class="sidebar">
    <div class="sidebar-logo">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
      </div>
      <div class="logo-text">
        <h1>MijnSanadome</h1>
        <span>Employee Portal</span>
      </div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-label">Menu</div>
      <a href="dashboard.html" class="nav-item">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/><rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="7" height="7" rx="1"/></svg>
        Dashboard
      </a>
      <a href="#placeholder-rooster" class="nav-item" data-permission="nav.rooster">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
        Mijn rooster
      </a>
      <a href="#placeholder-verlof" class="nav-item" data-permission="nav.verlof">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
        Verlof
      </a>
      <a href="#placeholder-documenten" class="nav-item" data-permission="nav.documenten">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        Documenten
      </a>
      <a href="#placeholder-berichten" class="nav-item" data-permission="nav.berichten">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
        Berichten
      </a>
      <div class="nav-label">Beheer</div>
      <a href="gebruikers.html" class="nav-item" data-permission="medewerkers.bekijken">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><line x1="20" y1="8" x2="20" y2="14"/><line x1="23" y1="11" x2="17" y2="11"/></svg>
        Medewerkers
      </a>
      <a href="nieuws.html" class="nav-item active" data-permission="nieuws.bekijken">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 22h16a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v16a2 2 0 0 1-2 2zm0 0a2 2 0 0 1-2-2v-9c0-1.1.9-2 2-2h2"/><line x1="10" y1="6" x2="18" y2="6"/><line x1="10" y1="10" x2="18" y2="10"/><line x1="10" y1="14" x2="14" y2="14"/></svg>
        Nieuwsbeheer
      </a>
      <a href="debiteuren.html" class="nav-item" data-permission="debiteuren.bekijken">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        Debiteuren
      </a>
      <a href="rechten.html" class="nav-item" data-permission="rechten.bekijken">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        Rechten
      </a>
      <div class="nav-label">Account</div>
      <a href="profiel.html" class="nav-item" data-permission="nav.gegevens">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        Mijn Profiel
      </a>
      <a href="#placeholder-hr" class="nav-item" data-permission="nav.hr">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        HR &amp; handboek
      </a>
    </nav>
  </aside>

  <!-- ‚îÄ‚îÄ Main ‚îÄ‚îÄ -->
  <div class="app-main">
    <header class="topbar">
      <div class="topbar-search-wrap">
        <input type="search" class="topbar-search" placeholder="Zoeken in MijnSanadome‚Ä¶" aria-label="Zoeken">
      </div>
      <div class="topbar-actions">
        <button type="button" class="topbar-icon-btn" aria-label="Meldingen">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        </button>
        <a href="profiel.html" class="topbar-user">
          <div class="topbar-avatar" id="user-avatar">‚Äî</div>
          <div class="topbar-user-info">
            <span class="topbar-user-name" id="user-name">Laden‚Ä¶</span>
            <span class="topbar-user-role" id="user-role">Medewerker</span>
          </div>
        </a>
        <button type="button" class="btn-logout" id="btn-logout">Uitloggen</button>
      </div>
    </header>

    <div class="main-content">
    <!-- Setup banner -->
    <div class="setup-banner" id="setup-banner" style="display:none;">
      <h3>üì∞ Nieuwstabel ontbreekt</h3>
      <p>Voer de volgende SQL uit in de <strong>Supabase SQL Editor</strong> om de nieuwstabel aan te maken:</p>
      <pre id="sql-code"></pre>
      <button onclick="location.reload()">üîÑ Opnieuw proberen</button>
    </div>

    <!-- Header -->
    <div class="page-header">
      <div>
        <h2>üì∞ Nieuwsbeheer</h2>
        <p>Beheer nieuwsberichten voor het dashboard</p>
      </div>
      <button type="button" class="btn-primary" id="btn-add-news" data-permission="nieuws.aanmaken">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Nieuw artikel
      </button>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
      <div class="search-box">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        <input type="text" id="search-input" placeholder="Zoek op titel of auteur‚Ä¶">
      </div>
      <button class="filter-btn active" data-filter="all">Alles</button>
      <button class="filter-btn" data-filter="gepubliceerd">Gepubliceerd</button>
      <button class="filter-btn" data-filter="concept">Concept</button>
    </div>

    <!-- Grid -->
    <div class="news-grid" id="news-grid">
      <div class="empty-state">
        <div class="empty-state-icon">üì∞</div>
        <h3>Nieuws laden‚Ä¶</h3>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Editor modal ‚îÄ‚îÄ -->
  <div class="modal-overlay" id="modal-editor">
    <div class="modal">
      <div class="modal-header">
        <h2 id="editor-title">Nieuw artikel</h2>
        <button class="modal-close" id="close-editor">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="modal-body">
        <form id="news-form" autocomplete="off">
          <!-- Titel -->
          <div class="form-group">
            <label for="input-title">Titel *</label>
            <input type="text" id="input-title" required placeholder="Titel van het artikel" maxlength="200">
          </div>

          <!-- Promo tekst -->
          <div class="form-group">
            <label for="input-promo">Promotekst</label>
            <textarea id="input-promo" rows="2" placeholder="Korte samenvatting voor op het dashboard (max 200 tekens)" maxlength="200"></textarea>
            <div class="form-hint">Wordt getoond als preview op het dashboard</div>
          </div>

          <!-- Thumbnail & status -->
          <div class="form-row">
            <div class="form-group">
              <label>Thumbnail</label>
              <input type="hidden" id="input-thumb" value="">
              <input type="file" id="thumb-file" accept="image/*" style="display:none;">
              <div class="thumb-upload-zone" id="thumb-upload-zone">
                <div class="upload-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div>
                <div class="upload-text"><strong>Klik of sleep</strong> een afbeelding hierheen<br>PNG, JPG, WebP ¬∑ max 5MB</div>
              </div>
              <div class="upload-progress" id="thumb-progress"><div class="upload-progress-bar" id="thumb-progress-bar"></div></div>
            </div>
            <div class="form-group" style="max-width:200px;">
              <label for="input-status">Status</label>
              <select id="input-status">
                <option value="concept">üìù Concept</option>
                <option value="gepubliceerd">‚úÖ Gepubliceerd</option>
              </select>
              <div class="form-hint" style="margin-top:16px;">
                <label for="input-pinned" style="display:flex;align-items:center;gap:8px;cursor:pointer;font-weight:500;">
                  <input type="checkbox" id="input-pinned" style="width:16px;height:16px;accent-color:var(--sanadome-blue);">
                  Vastpinnen bovenaan
                </label>
              </div>
            </div>
          </div>

          <!-- Rich text editor -->
          <div class="form-group">
            <label>Inhoud *</label>
            <div class="editor-toolbar" id="editor-toolbar">
              <button type="button" data-cmd="bold" title="Vet"><strong>B</strong></button>
              <button type="button" data-cmd="italic" title="Cursief"><em>I</em></button>
              <button type="button" data-cmd="underline" title="Onderstrepen"><u>U</u></button>
              <button type="button" data-cmd="strikeThrough" title="Doorhalen"><s>S</s></button>
              <div class="sep"></div>
              <button type="button" data-cmd="formatBlock" data-val="h2" title="Kop 2">H2</button>
              <button type="button" data-cmd="formatBlock" data-val="h3" title="Kop 3">H3</button>
              <button type="button" data-cmd="formatBlock" data-val="p" title="Paragraaf">¬∂</button>
              <div class="sep"></div>
              <button type="button" data-cmd="insertUnorderedList" title="Ongeordende lijst">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>
              </button>
              <button type="button" data-cmd="insertOrderedList" title="Genummerde lijst">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="10" y1="6" x2="21" y2="6"/><line x1="10" y1="12" x2="21" y2="12"/><line x1="10" y1="18" x2="21" y2="18"/><text x="3" y="7" font-size="6" fill="currentColor" stroke="none">1</text><text x="3" y="13" font-size="6" fill="currentColor" stroke="none">2</text><text x="3" y="19" font-size="6" fill="currentColor" stroke="none">3</text></svg>
              </button>
              <div class="sep"></div>
              <button type="button" data-cmd="formatBlock" data-val="blockquote" title="Citaat">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3z"/></svg>
              </button>
              <button type="button" id="btn-link" title="Link invoegen">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
              </button>
              <button type="button" id="btn-image" title="Afbeelding invoegen">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
              </button>
              <div class="sep"></div>
              <button type="button" data-cmd="removeFormat" title="Opmaak verwijderen">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="12" y1="12" x2="8" y2="18"/></svg>
              </button>
            </div>
            <div class="editor-content" id="editor-content" contenteditable="true"></div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn-secondary" id="btn-cancel">Annuleren</button>
            <button type="button" class="btn-secondary" id="btn-preview" style="color:var(--sanadome-blue);border-color:var(--sanadome-blue);">üëÅ Preview</button>
            <button type="submit" class="btn-save" id="btn-submit">Publiceren</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Delete modal ‚îÄ‚îÄ -->
  <div class="modal-overlay" id="modal-delete">
    <div class="modal delete-modal">
      <div class="modal-body">
        <div class="delete-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
        </div>
        <h3>Artikel verwijderen?</h3>
        <p id="delete-msg">Dit artikel wordt permanent verwijderd.</p>
        <div class="delete-actions">
          <button type="button" class="btn-secondary" id="cancel-delete">Annuleren</button>
          <button type="button" class="btn-danger" id="confirm-delete">Verwijderen</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Preview modal ‚îÄ‚îÄ -->
  <div class="modal-overlay" id="modal-preview">
    <div class="modal" style="max-width:700px;">
      <div class="modal-header">
        <h2>Preview</h2>
        <button class="modal-close" id="close-preview">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        </button>
      </div>
      <div class="modal-body" id="preview-body" style="line-height:1.8;"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ Toast ‚îÄ‚îÄ -->
  <div class="toast" id="toast"></div>

  <script>
    /* ‚îÄ‚îÄ Supabase clients ‚îÄ‚îÄ */
    var sb = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
    var adminSb = window.SUPABASE_SERVICE_ROLE_KEY
      ? supabase.createClient(window.SUPABASE_URL, window.SUPABASE_SERVICE_ROLE_KEY, {
          auth: { autoRefreshToken: false, persistSession: false }
        })
      : null;

    /* ‚îÄ‚îÄ SQL for setup ‚îÄ‚îÄ */
    var SETUP_SQL = "CREATE TABLE IF NOT EXISTS public.news (\n" +
      "  id uuid DEFAULT gen_random_uuid() PRIMARY KEY,\n" +
      "  title text NOT NULL,\n" +
      "  promo_text text DEFAULT '',\n" +
      "  content text DEFAULT '',\n" +
      "  thumbnail_url text DEFAULT '',\n" +
      "  status text DEFAULT 'concept' CHECK (status IN ('concept','gepubliceerd')),\n" +
      "  pinned boolean DEFAULT false,\n" +
      "  author_id uuid,\n" +
      "  author_name text DEFAULT '',\n" +
      "  published_at timestamptz,\n" +
      "  created_at timestamptz DEFAULT now(),\n" +
      "  updated_at timestamptz DEFAULT now()\n" +
      ");\n\n" +
      "ALTER TABLE public.news ENABLE ROW LEVEL SECURITY;\n\n" +
      "CREATE POLICY \"Authenticated users can read news\"\n" +
      "  ON public.news FOR SELECT TO authenticated USING (true);\n\n" +
      "CREATE POLICY \"Service role full access on news\"\n" +
      "  ON public.news FOR ALL TO service_role USING (true) WITH CHECK (true);\n\n" +
      "-- Storage bucket (voer uit in SQL Editor):\n" +
      "INSERT INTO storage.buckets (id, name, public) VALUES ('news-images', 'news-images', true)\n" +
      "  ON CONFLICT (id) DO NOTHING;\n\n" +
      "CREATE POLICY \"Public read news-images\" ON storage.objects\n" +
      "  FOR SELECT TO public USING (bucket_id = 'news-images');\n\n" +
      "CREATE POLICY \"Authenticated upload news-images\" ON storage.objects\n" +
      "  FOR INSERT TO authenticated WITH CHECK (bucket_id = 'news-images');\n\n" +
      "CREATE POLICY \"Authenticated update news-images\" ON storage.objects\n" +
      "  FOR UPDATE TO authenticated USING (bucket_id = 'news-images');\n\n" +
      "CREATE POLICY \"Authenticated delete news-images\" ON storage.objects\n" +
      "  FOR DELETE TO authenticated USING (bucket_id = 'news-images');\n\n" +
      "CREATE POLICY \"Service role full news-images\" ON storage.objects\n" +
      "  FOR ALL TO service_role USING (bucket_id = 'news-images') WITH CHECK (bucket_id = 'news-images');";

    document.getElementById('sql-code').textContent = SETUP_SQL;

    /* ‚îÄ‚îÄ State ‚îÄ‚îÄ */
    var allNews = [];
    var currentFilter = 'all';
    var searchQuery = '';
    var editingId = null;
    var deletingId = null;
    var currentUserId = null;
    var currentUserName = '';

    /* ‚îÄ‚îÄ DOM refs ‚îÄ‚îÄ */
    var grid = document.getElementById('news-grid');
    var modalEditor = document.getElementById('modal-editor');
    var modalDelete = document.getElementById('modal-delete');
    var modalPreview = document.getElementById('modal-preview');
    var newsForm = document.getElementById('news-form');
    var editorContent = document.getElementById('editor-content');

    /* ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ */
    function escapeHtml(s) {
      var d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML;
    }
    function showToast(msg, ms) {
      var t = document.getElementById('toast');
      t.textContent = msg; t.classList.add('show');
      setTimeout(function() { t.classList.remove('show'); }, ms || 3000);
    }
    function openModal(el) { el.classList.add('open'); }
    function closeModal(el) { el.classList.remove('open'); }
    function fmtDate(d) {
      return new Date(d).toLocaleDateString('nl-NL', { day: 'numeric', month: 'short', year: 'numeric' });
    }
    function fmtTime(d) {
      return new Date(d).toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });
    }
    function stripHtml(html) {
      var d = document.createElement('div'); d.innerHTML = html; return (d.textContent || d.innerText || '').trim();
    }

    /* ‚îÄ‚îÄ Rich text toolbar ‚îÄ‚îÄ */
    document.getElementById('editor-toolbar').addEventListener('click', function(e) {
      var btn = e.target.closest('button');
      if (!btn) return;
      e.preventDefault();

      var cmd = btn.getAttribute('data-cmd');
      var val = btn.getAttribute('data-val') || null;

      if (cmd) {
        document.execCommand(cmd, false, val);
        editorContent.focus();
        return;
      }

      if (btn.id === 'btn-link') {
        var url = prompt('Link URL:', 'https://');
        if (url) document.execCommand('createLink', false, url);
        editorContent.focus();
      }
      if (btn.id === 'btn-image') {
        var editorImgInput = document.createElement('input');
        editorImgInput.type = 'file'; editorImgInput.accept = 'image/*';
        editorImgInput.addEventListener('change', function() {
          if (!editorImgInput.files[0]) return;
          showToast('‚è≥ Afbeelding uploaden‚Ä¶');
          uploadImage(editorImgInput.files[0], 'content').then(function(url) {
            editorContent.focus();
            document.execCommand('insertImage', false, url);
            showToast('‚úÖ Afbeelding ingevoegd');
          }).catch(function(err) { showToast('‚ùå Upload mislukt: ' + err, 4000); });
        });
        editorImgInput.click();
      }
    });

    /* ‚îÄ‚îÄ Image upload helper ‚îÄ‚îÄ */
    var BUCKET = 'news-images';
    function uploadImage(file, pathPrefix) {
      if (!adminSb) return Promise.reject('Service role key ontbreekt');
      if (!file || !file.type.startsWith('image/')) return Promise.reject('Ongeldig bestandstype');
      if (file.size > 5 * 1024 * 1024) return Promise.reject('Bestand is groter dan 5MB');
      var ext = file.name.split('.').pop().toLowerCase() || 'jpg';
      var name = (pathPrefix || 'img') + '/' + Date.now() + '-' + Math.random().toString(36).slice(2, 8) + '.' + ext;
      return adminSb.storage.from(BUCKET).upload(name, file, {
        contentType: file.type, upsert: false
      }).then(function(res) {
        if (res.error) throw res.error.message;
        var pub = adminSb.storage.from(BUCKET).getPublicUrl(name);
        return pub.data.publicUrl;
      });
    }

    /* ‚îÄ‚îÄ Thumbnail upload zone ‚îÄ‚îÄ */
    var thumbInput = document.getElementById('input-thumb');
    var thumbFile = document.getElementById('thumb-file');
    var thumbZone = document.getElementById('thumb-upload-zone');
    var thumbProgress = document.getElementById('thumb-progress');
    var thumbProgressBar = document.getElementById('thumb-progress-bar');

    function showThumbPreview(url) {
      thumbInput.value = url;
      thumbZone.classList.add('has-image');
      thumbZone.innerHTML = '<button type="button" class="thumb-remove" title="Verwijderen">&times;</button>' +
        '<img src="' + escapeHtml(url) + '" alt="Preview">';
      thumbZone.querySelector('.thumb-remove').addEventListener('click', function(e) {
        e.stopPropagation();
        clearThumb();
      });
    }
    function clearThumb() {
      thumbInput.value = '';
      thumbZone.classList.remove('has-image');
      thumbZone.innerHTML = '<div class="upload-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></div>' +
        '<div class="upload-text"><strong>Klik of sleep</strong> een afbeelding hierheen<br>PNG, JPG, WebP ¬∑ max 5MB</div>';
    }
    function handleThumbUpload(file) {
      thumbProgress.style.display = '';
      thumbProgressBar.style.width = '30%';
      uploadImage(file, 'thumbnails').then(function(url) {
        thumbProgressBar.style.width = '100%';
        setTimeout(function() { thumbProgress.style.display = 'none'; thumbProgressBar.style.width = '0'; }, 500);
        showThumbPreview(url);
        showToast('‚úÖ Thumbnail ge√ºpload');
      }).catch(function(err) {
        thumbProgress.style.display = 'none'; thumbProgressBar.style.width = '0';
        showToast('‚ùå Upload mislukt: ' + err, 4000);
      });
    }

    thumbZone.addEventListener('click', function() { thumbFile.click(); });
    thumbFile.addEventListener('change', function() {
      if (thumbFile.files[0]) handleThumbUpload(thumbFile.files[0]);
      thumbFile.value = '';
    });
    thumbZone.addEventListener('dragover', function(e) { e.preventDefault(); thumbZone.classList.add('dragover'); });
    thumbZone.addEventListener('dragleave', function() { thumbZone.classList.remove('dragover'); });
    thumbZone.addEventListener('drop', function(e) {
      e.preventDefault(); thumbZone.classList.remove('dragover');
      if (e.dataTransfer.files[0]) handleThumbUpload(e.dataTransfer.files[0]);
    });

    /* ‚îÄ‚îÄ Auth check ‚îÄ‚îÄ */
    sb.auth.getSession().then(function(res) {
      if (!res.data.session) { window.location.href = 'index.html'; return; }
      return sb.auth.getUser();
    }).then(function(res) {
      if (!res || !res.data.user) { window.location.href = 'index.html'; return; }
      var user = res.data.user;
      currentUserId = user.id;
      var meta = user.user_metadata || {};
      currentUserName = ((meta.first_name || '') + ' ' + (meta.last_name || '')).trim() || user.email;
      var role = meta.role || 'Medewerker';

      document.getElementById('user-name').textContent = currentUserName;
      document.getElementById('user-role').textContent = role;
      var ini = currentUserName.split(/\s+/).map(function(s) { return (s[0] || '').toUpperCase(); }).slice(0, 2).join('');
      var avatarUrl = meta.avatar_url;
      if (avatarUrl) {
        document.getElementById('user-avatar').innerHTML = '<img src="' + avatarUrl + '" alt="" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">';
      } else {
        document.getElementById('user-avatar').textContent = ini;
      }

      // Permission enforcement
      var myRole = role;
      function getDefaultPerms(r) {
        var ALL = ['dashboard.nieuws','dashboard.berichten','dashboard.aanvragen','dashboard.contactgegevens','dashboard.dienstverband','dashboard.rooster','nav.rooster','nav.verlof','nav.documenten','nav.berichten','nav.gegevens','nav.hr','medewerkers.bekijken','medewerkers.aanmaken','medewerkers.bewerken','medewerkers.verwijderen','rechten.bekijken','rechten.bewerken','nieuws.bekijken','nieuws.aanmaken','nieuws.bewerken','nieuws.verwijderen','debiteuren.bekijken','debiteuren.beheren','debiteuren.importeren'];
        var p = {};
        ALL.forEach(function(k) {
          if (r === 'Manager') p[k] = true;
          else if (r === 'Assistent Manager') p[k] = k !== 'rechten.bewerken' && k !== 'medewerkers.verwijderen';
          else if (r === 'Senior Medewerker') p[k] = k.startsWith('dashboard.') || k.startsWith('nav.') || k === 'medewerkers.bekijken' || k === 'nieuws.bekijken' || k === 'debiteuren.bekijken';
          else p[k] = k.startsWith('dashboard.') || k.startsWith('nav.');
        });
        return p;
      }
      sb.from('role_permissions').select('permission, granted').eq('role', myRole).then(function(pr) {
        var perms = {};
        if (!pr.error && pr.data && pr.data.length > 0) {
          pr.data.forEach(function(r) { perms[r.permission] = r.granted; });
        } else {
          perms = getDefaultPerms(myRole);
        }
        return sb.from('user_permissions').select('permission, granted').eq('user_id', user.id).then(function(upr) {
          if (!upr.error && upr.data && upr.data.length > 0) {
            upr.data.forEach(function(r) { perms[r.permission] = r.granted; });
          }
          return perms;
        }).catch(function() { return perms; });
      }).then(function(perms) {
        if (perms['nieuws.bekijken'] === false) {
          window.location.href = 'dashboard.html'; return;
        }
        document.querySelectorAll('[data-permission]').forEach(function(el) {
          if (perms[el.getAttribute('data-permission')] === false) el.style.display = 'none';
        });
        window._userPerms = perms;
        // Init page only after permissions are loaded
        if (!adminSb) {
          document.getElementById('btn-add-news').disabled = true;
          document.getElementById('btn-add-news').style.opacity = '0.5';
          document.getElementById('btn-add-news').title = 'Service role key ontbreekt';
        }
        initPage();
      }).catch(function() {
        window._userPerms = getDefaultPerms(myRole);
        window.location.href = 'dashboard.html';
      });
    });

    /* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
    function initPage() {
      document.getElementById('btn-logout').addEventListener('click', function() {
        sb.auth.signOut().then(function() { window.location.href = 'index.html'; });
      });

      loadNews();

      // Search
      document.getElementById('search-input').addEventListener('input', function(e) {
        searchQuery = e.target.value.toLowerCase();
        renderNews();
      });

      // Filters
      document.querySelectorAll('.filter-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          currentFilter = btn.getAttribute('data-filter');
          document.querySelectorAll('.filter-btn').forEach(function(b) { b.classList.remove('active'); });
          btn.classList.add('active');
          renderNews();
        });
      });

      // Modal handlers
      document.getElementById('btn-add-news').addEventListener('click', function() { openCreateModal(); });
      document.getElementById('close-editor').addEventListener('click', function() { closeModal(modalEditor); });
      document.getElementById('btn-cancel').addEventListener('click', function() { closeModal(modalEditor); });
      document.getElementById('cancel-delete').addEventListener('click', function() { closeModal(modalDelete); });
      document.getElementById('confirm-delete').addEventListener('click', function() { confirmDelete(); });
      document.getElementById('close-preview').addEventListener('click', function() { closeModal(modalPreview); });

      // Preview
      document.getElementById('btn-preview').addEventListener('click', function() {
        var title = document.getElementById('input-title').value || 'Geen titel';
        var thumb = document.getElementById('input-thumb').value;
        var body = editorContent.innerHTML;
        var html = '';
        if (thumb) html += '<img src="' + escapeHtml(thumb) + '" style="width:100%;max-height:300px;object-fit:cover;border-radius:12px;margin-bottom:20px;" alt="">';
        html += '<h2 style="font-family:Plus Jakarta Sans,sans-serif;margin-bottom:12px;">' + escapeHtml(title) + '</h2>';
        html += '<div style="line-height:1.8;font-size:0.92rem;">' + body + '</div>';
        document.getElementById('preview-body').innerHTML = html;
        openModal(modalPreview);
      });

      // Form submit
      newsForm.addEventListener('submit', function(e) {
        e.preventDefault();
        saveArticle();
      });

      // Close modals on overlay click
      [modalEditor, modalDelete, modalPreview].forEach(function(m) {
        m.addEventListener('click', function(e) {
          if (e.target === m) closeModal(m);
        });
      });

      // Realtime subscription
      sb.channel('news-changes')
        .on('postgres_changes', { event: '*', schema: 'public', table: 'news' }, function() {
          loadNews();
        })
        .subscribe();
    }

    /* ‚îÄ‚îÄ Load news ‚îÄ‚îÄ */
    function loadNews() {
      sb.from('news').select('*').order('pinned', { ascending: false }).order('created_at', { ascending: false })
        .then(function(res) {
          if (res.error) {
            if (res.error.message && res.error.message.indexOf('role_permissions') === -1 &&
                (res.error.message.indexOf('news') !== -1 || res.error.code === '42P01')) {
              document.getElementById('setup-banner').style.display = '';
            }
            // Try to detect table not found
            if (res.error.message && res.error.message.indexOf("relation") !== -1 && res.error.message.indexOf("does not exist") !== -1) {
              document.getElementById('setup-banner').style.display = '';
            }
            if (res.error.message && res.error.message.indexOf("Could not find") !== -1 && res.error.message.indexOf("news") !== -1) {
              document.getElementById('setup-banner').style.display = '';
            }
            allNews = [];
          } else {
            document.getElementById('setup-banner').style.display = 'none';
            allNews = res.data || [];
          }
          renderNews();
        });
    }

    /* ‚îÄ‚îÄ Render news ‚îÄ‚îÄ */
    function renderNews() {
      var _p = window._userPerms || {};
      var canEdit = _p['nieuws.bewerken'] !== false;
      var canDelete = _p['nieuws.verwijderen'] !== false;

      var filtered = allNews.filter(function(n) {
        var matchStatus = currentFilter === 'all' || n.status === currentFilter;
        var matchSearch = !searchQuery ||
          (n.title || '').toLowerCase().indexOf(searchQuery) !== -1 ||
          (n.author_name || '').toLowerCase().indexOf(searchQuery) !== -1 ||
          (n.promo_text || '').toLowerCase().indexOf(searchQuery) !== -1;
        return matchStatus && matchSearch;
      });

      if (filtered.length === 0) {
        grid.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì∞</div><h3>Geen artikelen gevonden</h3><p>' +
          (allNews.length === 0 ? 'Maak je eerste nieuwsartikel aan.' : 'Pas je filters aan.') + '</p></div>';
        return;
      }

      grid.innerHTML = filtered.map(function(n) {
        var statusClass = 'status-' + n.status;
        var statusLabel = n.status === 'gepubliceerd' ? 'Gepubliceerd' : 'Concept';
        var excerpt = n.promo_text || stripHtml(n.content || '').substring(0, 120);
        var wordCount = stripHtml(n.content || '').split(/\s+/).filter(Boolean).length;
        var readTime = Math.max(1, Math.round(wordCount / 200));

        return '<div class="news-card">' +
          '<a href="artikel?id=' + n.id + '" style="text-decoration:none;color:inherit;display:block;cursor:pointer;">' +
          '<div class="news-card-thumb">' +
            (n.thumbnail_url ? '<img src="' + escapeHtml(n.thumbnail_url) + '" alt="" onerror="this.style.display=\'none\';this.parentNode.innerHTML+=\'üì∞\';">' : 'üì∞') +
            '<span class="news-card-status ' + statusClass + '">' + (n.pinned ? 'üìå ' : '') + statusLabel + '</span>' +
          '</div>' +
          '<div class="news-card-body">' +
            '<h3>' + escapeHtml(n.title) + '</h3>' +
            '<div class="news-card-promo">' + escapeHtml(excerpt) + '</div>' +
            '<div class="news-card-meta">' +
              '<span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg> ' + escapeHtml(n.author_name || 'Onbekend') + '</span>' +
              '<span><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg> ' + fmtDate(n.created_at) + '</span>' +
              '<span>~' + readTime + ' min</span>' +
            '</div>' +
          '</div>' +
          '</a>' +
          '<div class="news-card-actions">' +
            (canEdit ? '<button type="button" class="card-btn edit-btn" data-id="' + n.id + '"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg> Bewerken</button>' : '') +
            (canDelete ? '<button type="button" class="card-btn delete delete-btn" data-id="' + n.id + '" data-title="' + escapeHtml(n.title) + '"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg> Verwijderen</button>' : '') +
          '</div>' +
        '</div>';
      }).join('');

      // Attach listeners
      grid.querySelectorAll('.edit-btn').forEach(function(btn) {
        btn.addEventListener('click', function() { openEditModal(btn.getAttribute('data-id')); });
      });
      grid.querySelectorAll('.delete-btn').forEach(function(btn) {
        btn.addEventListener('click', function() {
          openDeleteModal(btn.getAttribute('data-id'), btn.getAttribute('data-title'));
        });
      });
    }

    /* ‚îÄ‚îÄ Create modal ‚îÄ‚îÄ */
    function openCreateModal() {
      editingId = null;
      document.getElementById('editor-title').textContent = 'Nieuw artikel';
      document.getElementById('btn-submit').textContent = 'Publiceren';
      newsForm.reset();
      editorContent.innerHTML = '';
      clearThumb();
      document.getElementById('input-status').value = 'concept';
      document.getElementById('input-pinned').checked = false;
      openModal(modalEditor);
    }

    /* ‚îÄ‚îÄ Edit modal ‚îÄ‚îÄ */
    function openEditModal(id) {
      var article = allNews.find(function(n) { return n.id === id; });
      if (!article) return;

      editingId = id;
      document.getElementById('editor-title').textContent = 'Artikel bewerken';
      document.getElementById('btn-submit').textContent = 'Opslaan';

      document.getElementById('input-title').value = article.title || '';
      document.getElementById('input-promo').value = article.promo_text || '';
      if (article.thumbnail_url) {
        showThumbPreview(article.thumbnail_url);
      } else {
        clearThumb();
      }
      document.getElementById('input-status').value = article.status || 'concept';
      document.getElementById('input-pinned').checked = !!article.pinned;
      editorContent.innerHTML = article.content || '';

      openModal(modalEditor);
    }

    /* ‚îÄ‚îÄ Save ‚îÄ‚îÄ */
    function saveArticle() {
      if (!adminSb) { showToast('‚ùå Service role key ontbreekt', 4000); return; }

      var title = document.getElementById('input-title').value.trim();
      var content = editorContent.innerHTML.trim();
      if (!title) { showToast('‚ùå Titel is verplicht', 3000); return; }
      if (!content || content === '<br>') { showToast('‚ùå Inhoud is verplicht', 3000); return; }

      var status = document.getElementById('input-status').value;
      var data = {
        title: title,
        promo_text: document.getElementById('input-promo').value.trim(),
        content: content,
        thumbnail_url: document.getElementById('input-thumb').value.trim(),
        status: status,
        pinned: document.getElementById('input-pinned').checked,
        author_id: currentUserId,
        author_name: currentUserName,
        updated_at: new Date().toISOString()
      };

      if (status === 'gepubliceerd') {
        data.published_at = data.published_at || new Date().toISOString();
      }

      var btn = document.getElementById('btn-submit');
      btn.disabled = true; btn.textContent = 'Opslaan‚Ä¶';

      var query;
      if (editingId) {
        query = adminSb.from('news').update(data).eq('id', editingId);
      } else {
        query = adminSb.from('news').insert([data]);
      }

      query.then(function(res) {
        btn.disabled = false;
        btn.textContent = editingId ? 'Opslaan' : 'Publiceren';
        if (res.error) {
          showToast('‚ùå ' + res.error.message, 4000);
        } else {
          showToast(editingId ? '‚úÖ Artikel bijgewerkt' : '‚úÖ Artikel aangemaakt');
          closeModal(modalEditor);
          loadNews();
        }
      });
    }

    /* ‚îÄ‚îÄ Delete ‚îÄ‚îÄ */
    function openDeleteModal(id, title) {
      deletingId = id;
      document.getElementById('delete-msg').textContent = '"' + title + '" wordt permanent verwijderd.';
      openModal(modalDelete);
    }

    function confirmDelete() {
      if (!deletingId || !adminSb) return;
      var btn = document.getElementById('confirm-delete');
      btn.disabled = true; btn.textContent = 'Verwijderen‚Ä¶';
      adminSb.from('news').delete().eq('id', deletingId).then(function(res) {
        btn.disabled = false; btn.textContent = 'Verwijderen';
        if (res.error) {
          showToast('‚ùå ' + res.error.message, 4000);
        } else {
          showToast('‚úÖ Artikel verwijderd');
          closeModal(modalDelete);
          deletingId = null;
          loadNews();
        }
      });
    }

  </script>
  </div><!-- /.app-main -->
</body>
</html>
